import{_ as U,k as D,aP as I,bf as M,r as c,o as A,n as i,A as _,q as r,u as a,j as e,K as b,aD as h,L as E,D as F,p as k,v as w,F as C,J as N}from"./index.32e23850.js";import{b as T,Q as j}from"./QSelect.1c1fbcf0.js";import{Q as G}from"./QExpansionItem.dd35a373.js";import{Q as J}from"./QList.6cb04e67.js";import{Q as K}from"./QPage.73906722.js";import{u as O}from"./useUsers.57a4c951.js";import{u as z}from"./usePermisos.08042042.js";import{u as H}from"./use-quasar.20dc04b9.js";import"./QItem.842ffa8b.js";import"./format.a0c35f62.js";import"./position-engine.ca5b71d8.js";const W=D({name:"permisosPage",setup(){O();const s=z(),l=H(),P=I();M();const{role:y,modulos:Q,permisos:p,getRoles:t,getModules:f,getRole:v,getPermissions:g,addPermissionsToRole:ne,savePermission:V}=s,$=c(""),S=c([{name:"role",label:"Role",field:"role",align:"center"},{name:"description",label:"Descripci\xF3n",field:"description",align:"center"},{name:"usuarios",label:"Usuarios",field:"usuarios",align:"center"},{name:"acciones",label:"Acciones",align:"center"}]),n=c([]),m=c({name:"",module:""}),u=(o,d)=>{l.notify({position:"top",type:d,message:o})},R=o=>{P.push({name:"assign",params:{id:o.id}})},q=async()=>{await g(),n.value=[],p.value.map(o=>{n.value.push({text:o.name,value:o.id,module_id:o.module_id})})},x=async()=>{if(m.value.module=="")return u("Selecciona un modulo para el nuevo permiso","negative"),!1;if(m.value.name=="")return u("Ingresa un nombre para el nuevo permiso","negative"),!1;l.dialog({title:"\xBFSeguro que quieres continuar?",message:"Se agregar\xE1 un nuevo permiso",ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async o=>{const d=await V(m.value);await q(),d.status==200?u("Se agreg\xF3 un nuevo permiso","positive"):u("Por favor contacta al administrador","negative")})},B=o=>n.value.filter(L=>L.module_id===o.id);return A(async()=>{await f(),await q()}),{columns:S,filter:$,role:y,modulos:Q,permisos:p,permissionsList:n,permiso:m,goTo:R,validatePermission:x,listaPermisos:B}}}),X={class:"row q-mt-lg"},Y={class:"col-xs-12"},Z={class:"q-pa-sm"},ee=a("span",{class:"text-h5"},"Permisos",-1),se={class:"row"},oe={class:"col-md-3"},ae={class:"col-md-3"},le={class:"col-md-2"},te={class:"row q-pa-sm q-mt-md"},re={class:"q-gutter-sm q-ml-sm"};function ie(s,l,P,y,Q,p){return i(),_(K,{class:"q-pa-sm"},{default:r(()=>[a("div",X,[a("div",Y,[a("div",Z,[e(N,{rounded:"",class:"q-pa-sm"},{default:r(()=>[e(b,null,{default:r(()=>[e(h),ee,e(h)]),_:1}),e(b,{class:"q-mt-md"},{default:r(()=>[a("div",se,[a("div",oe,[e(T,{modelValue:s.permiso.module,"onUpdate:modelValue":l[0]||(l[0]=t=>s.permiso.module=t),"option-label":"name",options:s.modulos,label:"Modulo",style:{width:"95%"}},null,8,["modelValue","options"])]),a("div",ae,[e(E,{label:"Permiso",modelValue:s.permiso.name,"onUpdate:modelValue":l[1]||(l[1]=t=>s.permiso.name=t),style:{width:"95%"}},null,8,["modelValue"])]),a("div",le,[e(F,{label:"guardar",color:"primary",class:"q-mt-md",onClick:s.validatePermission},null,8,["onClick"])])])]),_:1}),e(b,null,{default:r(()=>[e(J,{bordered:"",class:"rounded-borders"},{default:r(()=>[(i(!0),k(C,null,w(s.modulos,(t,f)=>(i(),_(G,{"expand-separator":"","header-class":"text-primary",label:`${t.name}`,key:f,style:{border:".2px solid gray"}},{default:r(()=>[e(h),a("div",te,[a("div",re,[(i(!0),k(C,null,w(s.listaPermisos(t),(v,g)=>(i(),_(j,{outline:"",key:g,color:"primary","text-color":"white",label:`${v.text}`,icon:"bookmark",val:v.id},null,8,["label","val"]))),128))])])]),_:2},1032,["label"]))),128))]),_:1})]),_:1})]),_:1})])])])]),_:1})}var Pe=U(W,[["render",ie]]);export{Pe as default};
