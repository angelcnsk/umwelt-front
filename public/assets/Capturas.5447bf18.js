import{b as G}from"./QSelect.03ac91b0.js";import{bk as pe,bl as x,aa as ve,k as oe,r as g,bt as fe,w as z,o as te,_ as se,n as S,p as k,u as n,j as t,q as u,Q as Y,ah as R,D as $,L as h,bd as Z,F as ee,v as he,A as W,aD as ge,bg as ae,x as L,a as Ve,ak as be,K as H,y as J,J as le,aE as ye,bm as Se,b6 as we}from"./index.402e5cb0.js";import{Q as F}from"./QTooltip.df6a31f4.js";import{Q as Ce}from"./QPage.fbc5bef6.js";import{C as B}from"./ClosePopup.81ec631a.js";import{u as re}from"./use-quasar.12cbe038.js";import{u as ne}from"./useUsers.3dcbe72b.js";import{d as ke,Q as M,a as $e}from"./QPopupProxy.a31a017a.js";import{Q as X,u as K,w as Ue}from"./xlsx.7ebc4d61.js";import{Q as qe}from"./QExpansionItem.93e2156c.js";import{Q as Ie}from"./QList.2b113048.js";import"./QItem.da63a453.js";import"./format.d9704788.js";import"./position-engine.b4a4220a.js";import"./TouchPan.a2e86cc2.js";const Pe=pe("capturas",{state:()=>({areas:[],a_points:[],numberDot:1,maxPoint:0,fo_aml_01_4:[],eventClickLocal:0,servicesList:[],currentService:{},luxometro:null,captureActive:!1}),actions:{getServiceList(a){const s="spa/getServiceStaff",m={params:{id:a}};return new Promise((v,c)=>{x.get(s,m).then(r=>{typeof a=="undefined"&&(this.servicesList=r.data.service_list),this.captureActive=r.data.capture_active!=null?r.data.capture_active:!1,this.fo_aml_01_4=r.data.table_a1!=null?r.data.table_a1:this.fo_aml_01_4,this.currentService=r.data.service_data!=null?r.data.service_data:this.currentService,this.a_points=r.data.service_data!=null?r.data.service_data:[],v()}).catch(r=>{c(r)})})},async saveAreas(a){const s="spa/createArea",m={};return new Promise((v,c)=>{x.post(s,a,m).then(r=>{v(r)}).catch(r=>{c(r)})})},getServiceAreas(){const a="spa/getServiceAreas",s={};return new Promise((m,v)=>{x.get(a,s).then(c=>{m()}).catch(c=>{v(c)})})},getAreas(a){const s="spa/getAreas",m={params:a};return new Promise((v,c)=>{x.get(s,m).then(r=>{this.areas=r.data.areas,v()}).catch(r=>{c(r)})})},saveCaptures(a){const s="spa/saveCaptures",m={},v={capturas:a};return new Promise((c,r)=>{x.post(s,v,m).then(e=>{e.data==null&&c(e),c(e)})})},saveLuxometro(){const a="spa/saveVerificationDevice",s={},m={luxometro:JSON.parse(localStorage.getItem("luxometro")),areas:JSON.parse(localStorage.getItem("areas_capturadas"))};return new Promise((v,c)=>{x.post(a,m,s).then(r=>{v(r)}).catch(r=>{c(r)})})},saveVerificationDevice(a){const s="spa/saveVerificationDevice",m={},v=JSON.parse(localStorage.getItem("luxometro")),c=a;return new Promise((r,e)=>{x.post(s,c,m).then(d=>{v.measure_id=d.data.measure_id,v.time=new Date,localStorage.setItem("luxometro",JSON.stringify(v)),r(d)}).catch(d=>{e(d)})})},setDateCapture(a){const s="spa/setDateCapture",m={};return new Promise((v,c)=>{x.post(s,a,m).then(r=>{v(r)}).catch(r=>{c(r)})})}}}),de=()=>{const a=Pe(),{getServiceList:s,saveAreas:m,getServiceAreas:v,getAreas:c,saveCaptures:r,saveLuxometro:e,eventSave:d,saveVerificationDevice:o,setDateCapture:E}=a,{areas:U,a_points:w,numberDot:q,maxPoint:C,captureActive:D,fo_aml_01_4:Q,eventClickLocal:j,servicesList:I,currentService:N,luxometro:V}=ve(a);return{areas:U,a_points:w,numberDot:q,maxPoint:C,captureActive:D,fo_aml_01_4:Q,eventClickLocal:j,servicesList:I,currentService:N,luxometro:V,getServiceList:s,saveAreas:m,getServiceAreas:v,getAreas:c,saveCaptures:r,saveLuxometro:e,eventSave:d,saveVerificationDevice:o,setDateCapture:E}},Le=oe({name:"captureIllumination",props:["show","puntos","area"],setup(a,s){const m=re();ne();const v=de(),{fo_aml_01_4:c,saveCaptures:r}=v,e=g([]),d=fe(a,"puntos"),o=g("");g([]);const E=()=>{const p=JSON.parse(localStorage.getItem("luxometro")),l=e.value.filter(i=>i.sync==0&&i.capture_date==p.date&&i.lux_end!=null);if(l.length==0||l==null)return m.dialog({title:"No hay puntos para sincronizar",message:"Para continuar selecciona una fecha de captura para cada punto, deber\xE1 coincidir con la fecha de verificaci\xF3n del lux\xF3metro"}).onOk(()=>{}),!1;l.length>0&&m.dialog({title:"\xBFDeseas continuar?",message:`Se encontraron ${l.length} puntos para sincronizar`,ok:{push:!0,label:"Aceptar",color:"primary"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async i=>{console.log(l);const T=await r(l);T.status==200?(l.map(A=>{e.value.map(O=>O.id==A.id?O.sync=1:O.sync)}),U("Las capturas se guardaron exitosamente","positive"),w()):U(T.response.data.msg,"negative")})},U=(p,l)=>{m.notify({position:"top",type:l,message:p})},w=()=>{if(e.value.length>0){const p=JSON.parse(localStorage.getItem("luxometro"));p!=null&&e.value.map(i=>{i.lux_start=p.start_value}),localStorage.getItem(`capturePoints_${e.value[0].user_id}`)===null?localStorage.setItem(`capturePoints_${e.value[0].user_id}`,JSON.stringify(e.value)):(localStorage.removeItem(`capturePoints_${e.value[0].user_id}`),localStorage.setItem(`capturePoints_${e.value[0].user_id}`,JSON.stringify(e.value))),U("La informaci\xF3n capturada se ha guardado con \xE9xito","positive")}};z(d,p=>{e.value=a.puntos,e.value.map(l=>{l.condicion_critica=l.condicion_critica!=0,l.pared=l.pared!=0,l.hora_1=l.hora_1==null?"00:00":l.hora_1,l.hora_2=l.hora_2==null?"00:00":l.hora_2,l.hora_3=l.hora_3==null?"00:00":l.hora_3,l.selected=!1}),o.value=a.area});const q=g(""),C=g([]),D=g(["Artificial","Natural","Artificial y Natural"]),Q=g(["Horizontal","Vertical","Oblicuo"]),j=async()=>{q.value=ke.formatDate(new Date,"YYYY/MM/DD")};z(C,p=>{p[0]=="all"?e.value.map(l=>l.selected=!0):e.value.map(l=>l.selected=!1)});const I=()=>{const p=q.value.split("/");e.value.map(l=>{l.selected&&(l.capture_date=`${p[0]}-${p[1]}-${p[2]}`),l.selected=!1}),C.value=[],w()},N=(p,l)=>{switch(p){case"plano_e1_1":e.value[l].plano_e1_1=V(e.value[l].plano_e1_1);break;case"plano_e1_2":e.value[l].plano_e1_2=V(e.value[l].plano_e1_2);break;case"plano_e1_3":e.value[l].plano_e1_3=V(e.value[l].plano_e1_3);break;case"plano_e2_1":e.value[l].plano_e2_1=V(e.value[l].plano_e2_1);break;case"plano_e2_2":e.value[l].plano_e2_2=V(e.value[l].plano_e2_2);break;case"plano_e2_3":e.value[l].plano_e2_3=V(e.value[l].plano_e2_3);break;case"pared_e1_1":e.value[l].pared_e1_1=V(e.value[l].pared_e1_1);break;case"pared_e1_2":e.value[l].pared_e1_2=V(e.value[l].pared_e1_2);break;case"pared_e1_3":e.value[l].pared_e1_3=V(e.value[l].pared_e1_3);break;case"pared_e2_1":e.value[l].pared_e2_1=V(e.value[l].pared_e2_1);break;case"pared_e2_2":e.value[l].pared_e2_2=V(e.value[l].pared_e2_2);break;case"pared_e2_3":e.value[l].pared_e2_3=V(e.value[l].pared_e2_3);break}},V=p=>{if(p==""||Number(p)%1==0)return p;const l=p;if(Number(l)>=0&&Number(l)<100){const i=l.split(".");return i[1]=i[1].substring(0,2),`${i[0]}.${i[1]}`}else if(Number(l)>=100&&Number(l)<=1e3){const i=l.split(".");return i[1]=i[1].substring(0,1),`${i[0]}.${i[1]}`}else if(Number(l)>=1e3)return`${l.split(".")[0]}`};return te(()=>{j()}),{fecha_captura:q,selection:C,fo_aml_01_4:c,tipo_luz:D,plano_trabajo:Q,puntos:e,setDate:I,ajustarRedondeo:N,localDot:w,async:E}}}),De={class:"row q-pa-sm"},Ne={class:"col-md-2"},xe={class:"row items-center justify-end"},je={class:"col-md-3 mt-1"},Qe={class:"q-pa-md q-mt-lg"},Ae={class:"row"},Oe={class:"row q-pa-sm"},Je={class:"col-md-1 d-inline-block ml-2"},ze={class:"col-md-3"},Re={class:"col-md-3"},Ee={class:"col-md-3"},Te={class:"row q-mt-sm q-pa-sm"},Fe={class:"col-md-2 ml-1"},Be={class:"col-md-2"},Ye={class:"row q-mt-sm q-pa-sm"},He={class:"col-md-2"},Me={class:"row items-center justify-end"},Ge={class:"col-md-2 q-ml-md"},Xe={class:"col-md-2"},Ke={key:0,class:"col-md-2"},We={key:1,class:"col-md-2"},Ze={key:0,class:"row q-mt-md q-pa-sm"},ea={class:"col-md-2"},aa={class:"row items-center justify-end"},la={class:"col-md-2 q-ml-md"},oa={class:"col-md-2"},ta={key:0,class:"col-md-2"},sa={key:1,class:"col-md-2"},ra={key:1,class:"row q-mt-md q-pa-sm"},na={class:"col-md-2"},da={class:"row items-center justify-end"},ua={class:"col-md-2 q-ml-md"},ia={class:"col-md-2"},ca={key:0,class:"col-md-2"},_a={key:1,class:"col-md-2"},ma={class:"row q-mt-md q-pa-md q-mb-lg"},pa={class:"col-md-2"},va={class:"col-md-4"};function fa(a,s,m,v,c,r){return S(),k(ee,null,[n("div",De,[n("div",Ne,[t(h,{class:"q-mt-sm q-ml-sm",filled:"",modelValue:a.fecha_captura,"onUpdate:modelValue":s[1]||(s[1]=e=>a.fecha_captura=e),mask:"date",style:{"max-width":"180px",width:"150px"}},{append:u(()=>[t(Y,{name:"event",class:"cursor-pointer"},{default:u(()=>[t(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:u(()=>[t($e,{modelValue:a.fecha_captura,"onUpdate:modelValue":s[0]||(s[0]=e=>a.fecha_captura=e)},{default:u(()=>[n("div",xe,[R(t($,{label:"Close",color:"primary",flat:""},null,512),[[B]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),n("div",je,[t($,{class:"q-mt-md",color:"primary",outline:"",label:"guardar",onClick:a.setDate},null,8,["onClick"])])]),n("div",Qe,[n("div",Ae,[t(Z,{modelValue:a.selection,"onUpdate:modelValue":s[2]||(s[2]=e=>a.selection=e),val:"all",class:"q-mt-md",label:"Seleccionar todos"},null,8,["modelValue"])]),t(Ie,{bordered:"",class:"rounded-borders"},{default:u(()=>[(S(!0),k(ee,null,he(a.puntos,(e,d)=>(S(),W(qe,{"expand-separator":"",icon:"ads_click","header-class":e.sync==1?"text-primary":"text-red",label:`Dpto:${e.department} \xC1rea: ${e.area} Pto: ${d+1} `,key:d,caption:`Fecha Captura: ${e.capture_date!=null?e.capture_date:""} Luxometro: Inicio: ${e.lux_start!=null?e.lux_start:""} Final: ${e.lux_end!=null?e.lux_end:""} `,style:{border:".2px solid gray"}},{default:u(()=>[t(ge),n("div",Oe,[n("div",Je,[t(Z,{modelValue:e.selected,"onUpdate:modelValue":o=>e.selected=o,val:d,class:"q-mt-md"},null,8,["modelValue","onUpdate:modelValue","val"])]),n("div",ze,[t(h,{modelValue:e.ubicacion,"onUpdate:modelValue":o=>e.ubicacion=o,label:"Ubicaci\xF3n",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue"])]),n("div",Re,[t(G,{modelValue:e.tipo_luz,"onUpdate:modelValue":o=>e.tipo_luz=o,options:a.tipo_luz,label:"Tipo de luz",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","options"])]),n("div",Ee,[t(G,{modelValue:e.plano_trabajo,"onUpdate:modelValue":o=>e.plano_trabajo=o,options:a.plano_trabajo,label:"Plano de trabajo",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","options"])])]),n("div",Te,[n("div",Fe,[t(ae,{modelValue:e.condicion_critica,"onUpdate:modelValue":o=>e.condicion_critica=o,label:"Condici\xF3n cr\xEDtica"},null,8,["modelValue","onUpdate:modelValue"])]),n("div",Be,[t(ae,{modelValue:e.pared,"onUpdate:modelValue":o=>e.pared=o,label:"Pared"},null,8,["modelValue","onUpdate:modelValue"])])]),n("div",Ye,[n("div",He,[t(h,{ref_for:!0,ref:"inicio",filled:"",modelValue:e.hora_1,"onUpdate:modelValue":o=>e.hora_1=o,mask:"time",rules:["time"],label:"Hora 1",class:"q-ml-sm",style:{"max-width":"180px"}},{append:u(()=>[t(Y,{name:"access_time",class:"cursor-pointer"},{default:u(()=>[t(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:u(()=>[t(X,{modelValue:e.hora_1,"onUpdate:modelValue":o=>e.hora_1=o},{default:u(()=>[n("div",Me,[R(t($,{label:"Close",color:"primary",flat:""},null,512),[[B]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),n("div",Ge,[t(h,{label:"plano_e1_1",modelValue:e.plano_e1_1,"onUpdate:modelValue":o=>e.plano_e1_1=o,onChange:o=>a.ajustarRedondeo("plano_e1_1",d),name:"plano_e1_1",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),n("div",Xe,[t(h,{label:"plano_e2_1",modelValue:e.plano_e2_1,"onUpdate:modelValue":o=>e.plano_e2_1=o,onChange:o=>a.ajustarRedondeo("plano_e2_1",d),name:"plano_e2_1",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),e.pared?(S(),k("div",Ke,[t(h,{label:"pared_e1_1",modelValue:e.pared_e1_1,"onUpdate:modelValue":o=>e.pared_e1_1=o,onChange:o=>a.ajustarRedondeo("pared_e1_1",d),name:"pared_e1_1",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])):L("",!0),e.pared?(S(),k("div",We,[t(h,{label:"pared_e2_1",modelValue:e.pared_e2_1,"onUpdate:modelValue":o=>e.pared_e2_1=o,onChange:o=>a.ajustarRedondeo("plano_e2_1",d),name:"pared_e2_1",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])):L("",!0)]),e.tipo_luz!="Artificial"&&e.tipo_luz!=null?(S(),k("div",Ze,[n("div",ea,[t(h,{ref_for:!0,ref:"inicio",filled:"",modelValue:e.hora_2,"onUpdate:modelValue":o=>e.hora_2=o,mask:"time",rules:["time"],label:"Hora 2",class:"q-ml-sm",style:{"max-width":"180px"}},{append:u(()=>[t(Y,{name:"access_time",class:"cursor-pointer"},{default:u(()=>[t(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:u(()=>[t(X,{modelValue:e.hora_2,"onUpdate:modelValue":o=>e.hora_2=o},{default:u(()=>[n("div",aa,[R(t($,{label:"Close",color:"primary",flat:""},null,512),[[B]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),n("div",la,[t(h,{label:"plano_e1_2",modelValue:e.plano_e1_2,"onUpdate:modelValue":o=>e.plano_e1_2=o,onChange:o=>a.ajustarRedondeo("plano_e1_2",d),name:"plano_e1_2",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),n("div",oa,[t(h,{label:"plano_e2_2",modelValue:e.plano_e2_2,"onUpdate:modelValue":o=>e.plano_e2_2=o,onChange:o=>a.ajustarRedondeo("plano_e2_2",d),name:"plano_e2_2",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),e.pared?(S(),k("div",ta,[t(h,{label:"pared_e1_2",modelValue:e.pared_e1_2,"onUpdate:modelValue":o=>e.pared_e1_2=o,onChange:o=>a.ajustarRedondeo("pared_e1_2",d),name:"pared_e1_2",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])):L("",!0),e.pared?(S(),k("div",sa,[t(h,{label:"pared_e2_2",modelValue:e.pared_e2_2,"onUpdate:modelValue":o=>e.pared_e2_2=o,onChange:o=>a.ajustarRedondeo("pared_e2_2",d),name:"pared_e2_2",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])):L("",!0)])):L("",!0),e.tipo_luz!="Artificial"&&e.tipo_luz!=null?(S(),k("div",ra,[n("div",na,[t(h,{ref_for:!0,ref:"inicio",filled:"",modelValue:e.hora_3,"onUpdate:modelValue":o=>e.hora_3=o,mask:"time",rules:["time"],label:"Hora 3",class:"q-ml-sm",style:{"max-width":"180px"}},{append:u(()=>[t(Y,{name:"access_time",class:"cursor-pointer"},{default:u(()=>[t(M,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:u(()=>[t(X,{modelValue:e.hora_3,"onUpdate:modelValue":o=>e.hora_3=o},{default:u(()=>[n("div",da,[R(t($,{label:"Close",color:"primary",flat:""},null,512),[[B]])])]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),n("div",ua,[t(h,{label:"plano_e1_3",modelValue:e.plano_e1_3,"onUpdate:modelValue":o=>e.plano_e1_3=o,onChange:o=>a.ajustarRedondeo("plano_e1_3",d),name:"plano_e1_3",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),n("div",ia,[t(h,{label:"plano_e2_3",modelValue:e.plano_e2_3,"onUpdate:modelValue":o=>e.plano_e2_3=o,onChange:o=>a.ajustarRedondeo("plano_e2_3",d),name:"plano_e2_3",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])]),e.pared?(S(),k("div",ca,[t(h,{label:"pared_e1_3",modelValue:e.pared_e1_3,"onUpdate:modelValue":o=>e.pared_e1_3=o,onChange:o=>a.ajustarRedondeo("pared_e1_3",d),name:"pared_e1_3",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])):L("",!0),e.pared?(S(),k("div",_a,[t(h,{label:"pared_e2_3",modelValue:e.pared_e2_3,"onUpdate:modelValue":o=>e.pared_e2_3=o,onChange:o=>a.ajustarRedondeo("pared_e2_3",d),name:"pared_e2_3",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","onChange"])])):L("",!0)])):L("",!0),n("div",ma,[n("div",pa,[t(G,{label:"Tarea visual",modelValue:e.fo_aml_01_4_id,"onUpdate:modelValue":o=>e.fo_aml_01_4_id=o,options:a.fo_aml_01_4,"option-label":"fo_aml_01_3",onInput:o=>a.setFoAml4(e),style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue","options","onInput"])]),n("div",va,[t(h,{label:"Observaciones",modelValue:e.observaciones,"onUpdate:modelValue":o=>e.observaciones=o,name:"observaciones",style:{width:"95%"}},null,8,["modelValue","onUpdate:modelValue"])])])]),_:2},1032,["header-class","label","caption"]))),128))]),_:1})])],64)}var ha=se(Le,[["render",fa]]);const ga=oe({name:"Capturas",components:{captureIllumination:ha},setup(){ne();const a=de(),s=re(),{getServiceList:m,servicesList:v,a_points:c,captureActive:r,currentService:e,getAreas:d,areas:o,fo_aml_01_4:E,luxometro:U}=a,w=(_,f)=>{s.notify({position:"top",type:f,message:_})};Ve(()=>serviceItem.value);const q=g(null),C=g(null),D=g(null),Q=g([]),j=g(0),I=g([]),N=g(!1),V=g(!1),p=g();g([]);const l=g(!0),i=g(null);g(!1);const T=()=>{if(c.value.length>0){const f=c.value[0].user_id,b=JSON.parse(localStorage.getItem(`capturePoints_${f}`));if(b!=null)return I.value=b,l.value=!1,A(),!1}const _=c.value;if(_.length>0){localStorage.setItem(`capturePoints_${_[0].user_id}`,JSON.stringify(_));const f=JSON.parse(localStorage.getItem(`capturePoints_${_[0].user_id}`));localStorage.removeItem(`capturePoints_${_[0].user_id}`),f.forEach(b=>{b.fo_aml_01_4_id>0&&(b.fo_aml_01_4_id=E.value.filter(P=>P.id===b.fo_aml_01_4_id)[0])}),I.value=f}else I.value=[];A()},A=()=>{const _=O(new Date),f=JSON.parse(localStorage.getItem("luxometro"));if(f!==null){if(i.value=f,i.value.date<_)return localStorage.removeItem("luxometro"),w("Es necesario que verifques el luxometro","negative"),i.value=U.value,!1}else w("Es necesario que verifques el luxometro","negative"),console.log(U.value),i.value=U.value;l.value=!1};z(N,_=>{if(_){const f=JSON.parse(localStorage.getItem("luxometro"));i.value=f!=null?f:U.value}});const O=_=>{const f=_.getFullYear().toString(),b=(_.getMonth()+101).toString().substring(1),P=(_.getDate()+100).toString().substring(1);return`${f}-${b}-${P}`},ue=()=>{i.value.start_value===void 0&&i.value.end_value===void 0&&w("Por favor ingresa un valor v\xE1lido","negative"),i.value.start_value!==void 0&&i.value.start_value!==""&&i.value.end_value===void 0&&(i.value.date=O(new Date),localStorage.setItem("luxometro",JSON.stringify(i.value)),w("No olvides ingresar el valor final, al terminar tus capturas","warning"),l.value=!1,setTimeout(()=>{N.value=!1},500)),i.value.end_value!==void 0&&i.value.end_value!==""&&(localStorage.setItem("luxometro",JSON.stringify(i.value)),I.value.map(_=>_.capture_date==i.value.date?_.lux_end=i.value.end_value:_.lux_end),localStorage.setItem(`capturePoints_${I.value[0].user_id}`,JSON.stringify(I.value)),setTimeout(()=>{N.value=!1},500)),console.log("bloquea",l.value)},ie=()=>{s.dialog({title:"\xBFEst\xE1s seguro?",message:"Esta acci\xF3n borrar\xE1 toda la informaci\xF3n guardada en tu dispositivo",ok:{push:!0,label:"Si, borrar",color:"red-4"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async _=>{const f=JSON.parse(localStorage.getItem("serviceList")),b=JSON.parse(localStorage.getItem("areas_capturadas"));f!=null&&f.forEach(P=>{localStorage.removeItem(`service_data${P.id}`)}),b!=null&&b.forEach(P=>{localStorage.removeItem(`capturePointsArea_${P}`)}),localStorage.removeItem("luxometro"),localStorage.removeItem("serviceList"),localStorage.removeItem("deviceList"),localStorage.removeItem("areas_capturadas"),w("Se borr\xF3 la informaci\xF3n guardada sin conexi\xF3n","positive")})},ce=()=>{const _=Object.keys(localStorage),f=[];if(_.find(b=>{b.substring(0,14)=="capturePoints_"&&JSON.parse(localStorage.getItem(`${b}`)).forEach(y=>{delete y.producto,delete y.norma,delete y.categoria_norma,delete y.department_id,delete y.department,delete y.status,delete y.created_at,delete y.updated_at,delete y.deleted_at,delete y.service_name,delete y.selected,y.fo_aml_01_4_id=y.fo_aml_01_4_id!=null?y.fo_aml_01_4_id.fo_aml_01_4:null,f.push(y)})}),f.length>0){const b=K.json_to_sheet(f),P=K.book_new();K.book_append_sheet(P,b,"capturas_puntos_medicion"),Ue(P,"capturas.xlsx")}else w("No hay informaci\xF3n para exportar","negative")};z(q,async _=>{console.log(_),Q.value=[],C.value="",j.value=0,U.value={identificador:_.identificador,id:_.device_id,lux_start:null,lux_end:null},q.value!==null&&(V.value=!0,j.value=q.value.product_id,await m(q.value.id),T())}),z(C,async()=>{D.value="",C.value!==null&&C.value!==""&&await d({department_id:C.value.id})}),z(D,_=>{D.value!==null&&D.value!==""&&(T(),A())});const _e=()=>{p.value!=null&&p.value.localDot()},me=()=>{p.value!=null&&r&&p.value.async()};return te(async()=>{window.navigator.onLine&&(await m(),A())}),{serviceSelected:q,captureActive:r,departmentSelected:C,areaSelected:D,servicesList:v,departments:Q,areas:o,typeProduct:j,puntos_captura:I,checkLuxo:N,device:i,showPoints:V,bloquea:l,captureActive:r,displayPoints:p,saveLuxometro:ue,cleanData:ie,exportCapture:ce,sincronizar:me,guardarLocal:_e}}}),Va={class:"q-pa-md"},ba={class:"row"},ya={class:"col-xs-12 col-md-4"},Sa={class:"row q-gutter-sm"},wa=n("br",null,null,-1),Ca={key:0,class:"row q-pa-md bg-warning q-mt-md justify-center rounded"},ka={key:0,class:"text-subtitle2 text-center"},$a={class:"q-mt-md"},Ua={class:"row justify-between"},qa={class:"col-md-5",style:{}},Ia={class:"col-md-5"};function Pa(a,s,m,v,c,r){const e=be("capture-illumination");return S(),W(Ce,{class:"q-pa-sm"},{default:u(()=>[n("div",Va,[t(le,{rounded:"",class:"q-mb-md"},{default:u(()=>[t(H,null,{default:u(()=>[n("div",ba,[n("div",ya,[t(G,{options:a.servicesList,"option-label":"service_name",modelValue:a.serviceSelected,"onUpdate:modelValue":s[0]||(s[0]=d=>a.serviceSelected=d),label:"Servicio",style:{width:"95%"}},null,8,["options","modelValue"])])])]),_:1}),t(H,null,{default:u(()=>[n("div",Sa,[t($,{label:"verificar lux\xF3metro",disable:a.device==null,outline:"",color:"primary",onClick:s[1]||(s[1]=d=>a.checkLuxo=!a.checkLuxo)},{default:u(()=>[t(F,null,{default:u(()=>[J("Abre ventana para ingresar valores de verificaci\xF3n de luxometro")]),_:1})]),_:1},8,["disable"]),t($,{label:"guardar capturas",outline:"",color:"primary",onClick:a.guardarLocal},{default:u(()=>[t(F,null,{default:u(()=>[J("Guarda los valores capturados en tu dispositivo")]),_:1})]),_:1},8,["onClick"]),t($,{label:"limpiar datos",color:"red-4",outline:"",onClick:a.cleanData},{default:u(()=>[t(F,null,{default:u(()=>[J("Borra los valores capturados de tu dispositivo")]),_:1})]),_:1},8,["onClick"]),t($,{label:"Exportar",color:"primary",outline:"",onClick:a.exportCapture},{default:u(()=>[t(F,null,{default:u(()=>[J("Descarga las capturas realizadas")]),_:1})]),_:1},8,["onClick"]),t($,{label:"sincronizar",color:"primary",disable:!a.captureActive&&a.bloquea,onClick:a.sincronizar},{default:u(()=>[t(F,{class:"text-center"},{default:u(()=>[J(" Guarda los valores capturados en el servidor"),wa,J(" Se debe guardar cada \xE1rea ")]),_:1})]),_:1},8,["disable","onClick"])])]),_:1})]),_:1}),a.device!=null&&a.device.end_value==null?(S(),k("div",Ca,[a.device.end_value==null?(S(),k("span",ka," Falta ingresar el valor final de la verificaci\xF3n de lux\xF3metro, favor de ingresarlo previo a cerrar capturas ")):L("",!0)])):L("",!0),R(n("div",$a,[a.typeProduct===1?(S(),W(e,{key:0,ref:"displayPoints",show:a.showPoints,puntos:a.puntos_captura,area:a.areaSelected},null,8,["show","puntos","area"])):L("",!0)],512),[[ye,a.puntos_captura.length>0&&!a.bloquea]]),t(we,{modelValue:a.checkLuxo,"onUpdate:modelValue":s[5]||(s[5]=d=>a.checkLuxo=d),"transition-show":"flip-down","transition-hide":"flip-up",persistent:""},{default:u(()=>[t(le,{class:"q-dialog-plugin"},{default:u(()=>[t(H,null,{default:u(()=>[t(h,{modelValue:a.device.identificador,"onUpdate:modelValue":s[2]||(s[2]=d=>a.device.identificador=d),label:"Lux\xF3metro",disable:!0},null,8,["modelValue"])]),_:1}),t(H,null,{default:u(()=>[n("div",Ua,[n("div",qa,[t(h,{type:"number",label:"Valor inicial",modelValue:a.device.start_value,"onUpdate:modelValue":s[3]||(s[3]=d=>a.device.start_value=d),style:{width:"95%"},min:"0",step:".1"},null,8,["modelValue"])]),n("div",Ia,[t(h,{type:"number",label:"Valor final",modelValue:a.device.end_value,"onUpdate:modelValue":s[4]||(s[4]=d=>a.device.end_value=d),style:{width:"95%"},min:"0",step:".1"},null,8,["modelValue"])])])]),_:1}),t(Se,{align:"right"},{default:u(()=>[R(t($,{color:"dark",label:"Cancelar"},null,512),[[B]]),t($,{color:"primary",label:"Guardar",onClick:a.saveLuxometro},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1})}var Ya=se(ga,[["render",Pa]]);export{Ya as default};
