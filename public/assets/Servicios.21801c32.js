import{Q as ue}from"./QTooltip.df6a31f4.js";import{_ as ce,k as ve,aP as me,r as u,a as pe,w as R,o as fe,n as D,A as $,q as t,u as s,D as f,j as a,y as v,x as N,p as ge,K as _e,bg as we,L as w,Q as b,ah as P,J as E,z}from"./index.402e5cb0.js";import{b as V,Q as G}from"./QSelect.03ac91b0.js";import{b as F,Q as Y}from"./QItem.da63a453.js";import{d as y,Q as U,a as L}from"./QPopupProxy.a31a017a.js";import{Q as be,a as J}from"./QTable.1c2883e8.js";import{Q as Ve}from"./QPage.fbc5bef6.js";import{C as M}from"./ClosePopup.81ec631a.js";import{u as ye}from"./useClientes.f256c5cc.js";import{u as he}from"./useUsers.3dcbe72b.js";import{u as Ce}from"./useServicios.d1a31ea0.js";import{u as Se}from"./use-quasar.12cbe038.js";import"./position-engine.b4a4220a.js";import"./format.d9704788.js";import"./QList.2b113048.js";import"./QMarkupTable.dab9a1ee.js";const Qe=ve({name:"serviciosPage",setup(){const e=ye(),i=he(),T=Ce(),h=Se(),I=me(),{AppActiveUser:g}=i,{getClients:l,clients:j,createClient:He}=e,{staff:A,getStaff:K,getService:We,generarOT:Xe,servicesList:H,productos:W,getProductos:X,getServices:B,newService:Z}=T,C=u(!1),O=u(!1),x=u(null),S=u([]),Q=u([]),q=u([]),k=u([]),ee=Date.now(),c=y.formatDate(ee,"YYYY/MM/DD"),o=u({recognition:!1,date_recognition:c,date_start:c,date_end:c}),ae=u(""),le=[{label:"Id",field:"id",sortable:!1,align:"center"},{label:"OT",field:"ot",align:"center"},{label:"Estatus",field:"status",html:!0,align:"center"},{label:"Cliente",field:"cliente",align:"center"},{label:"Producto",field:"producto",align:"center"},{label:"Solicitante",field:"requester",html:!0,align:"center"},{label:"Responsable",field:"owner",align:"center"},{label:"Fecha creaci\xF3n",field:"create_date",align:"center"},{label:"Reconocimiento",field:"recognition",html:!0,align:"center"},{label:"Fecha reconocimiento",field:"end_date",align:"center"},{label:"Fecha inicial",field:"start_date",align:"center"},{label:"Fecha final",field:"end_date",align:"center"}],d=(n,r)=>{h.notify({position:"top",type:r,message:n})},oe=pe(async()=>g.value.permissions);R(oe,async n=>{const r=await n;C.value=r.find(_=>_==="agregar_servicio")}),R(()=>o,(n,r)=>{n.value.client&&(Q.value=n.value.client.plantas),n.value.recognition||(o.value.date_recognition=null)},{deep:!0});const te=()=>o.value.producto==null||o.value.producto==null?(d("Para continuar selecciona un producto","negative"),!1):o.value.client==null||o.value.client==null?(d("Para continuar selecciona un cliente","negative"),!1):o.value.planta==null||o.value.planta==null?(d("Para continuar selecciona una planta","negative"),!1):o.value.owner==null||o.value.owner==null?(d("Para continuar selecciona un responsable","negative"),!1):o.value.recognition&&o.value.date_recognition==null||o.value.recognition&&o.value.date_recognition==null?(d("Falta fecha de reconocimiento","negative"),!1):o.value.date_start==null||o.value.date_start==null?(d("Falta fecha de inicio de servicio","negative"),!1):o.value.date_end==null||o.value.date_end==null?(d("Falta fecha de fin de servicio","negative"),!1):!0,ie=async()=>{te()&&h.dialog({title:"\xBFEst\xE1s seguro?",message:"Se iniciar\xE1 un nuevo servicio",ok:{push:!0,label:"Aceptar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async n=>{o.value.recognition_date=y.formatDate(o.value.date_recognition,"YYYY-MM-DD"),o.value.start_date=y.formatDate(o.value.date_recognition,"YYYY-MM-DD"),o.value.end_date=y.formatDate(o.value.date_recognition,"YYYY-MM-DD"),o.value.producto_id=o.value.producto.id,o.value.client_id=o.value.client.id,o.value.planta_id=o.value.planta.client_id,o.value.owner_id=o.value.owner.value,(await Z(o.value)).status==200?(d("Se cre\xF3 un nuevo servicio","positive"),o.value={recognition:!1,date_recognition:c,date_start:c,date_end:c},O.value=!1):d("Error al crear un nuevo servicio","negative"),await B()}).onCancel(()=>{}).onDismiss(()=>{})},se=(n,r,_)=>{if(n===""){r(()=>{S.value=j.value});return}r(()=>{const m=n.toLowerCase();S.value=j.value.filter(p=>p.legalname.toLowerCase().indexOf(m)>-1)})},ne=(n,r,_)=>{if(n===""){r(()=>{k.value=A.value});return}r(()=>{const m=n.toLowerCase();k.value=A.value.filter(p=>p.label.toLowerCase().indexOf(m)>-1)})},re=(n,r,_)=>{if(n===""){r(()=>{q.value=Q.value});return}r(()=>{const m=n.toLowerCase();q.value=Q.value.filter(p=>p.alias.toLowerCase().indexOf(m)>-1)})},de=(n,r)=>{I.push({name:"servicio",params:{id:r.id}})};return fe(async()=>{g.value.permissions&&(C.value=g.value.permissions.find(n=>n==="agregar_servicio")),await l(),await X(),await B(),await K({owner_service:!0})}),{agregar_servicio:C,servicesList:H,columns:le,filter:ae,addService:O,service:o,productos:W,clientes:S,clienteSelected:x,plantas:q,owners:k,goTo:de,filterFn:se,filterPlanta:re,filterStaff:ne,saveService:ie,getClients:l}}}),qe={class:"row q-pa-sm"},ke={class:"col-md-12"},De={key:0,class:"row q-mt-lg q-pa-sm"},Pe={class:"col-xs-12"},Fe=s("div",{class:"row"},[s("span",{class:"text-h5"}," Generar nueva orden de servicio ")],-1),Ye={class:"row"},Ue={class:"col-md-3 col-xs-12 q-pa-sm"},Le={class:"col-md-3 col-xs-12 q-pa-sm"},Me={class:"col-md-3 col-xs-12 q-pa-sm"},Te={class:"col-md-3 col-xs-12 q-pa-sm"},Ie={class:"col-md-3 q-pa-sm"},je={class:"row"},Ae={class:"col-md-4 col-xs-12 q-pa-sm"},Be={class:"row items-center justify-end"},Oe={class:"col-md-4 col-xs-12 q-pa-sm"},Re={class:"row items-center justify-end"},$e={class:"col-md-4 col-xs-12 q-pa-sm"},Ne={class:"row items-center justify-end"},Ee={class:"row justify-end q-mr-sm"},ze={class:"row q-mt-lg"},Ge={class:"col-xs-12"},Je={class:"q-pa-sm"};function Ke(e,i,T,h,I,g){return D(),$(Ve,{class:"q-pa-sm"},{default:t(()=>[s("div",qe,[s("div",ke,[e.agregar_servicio?(D(),$(f,{key:0,onClick:i[0]||(i[0]=l=>e.addService=!e.addService),color:"primary",glossy:"","text-color":"white",icon:"add_task"},{default:t(()=>[a(ue,{anchor:"center right",self:"center left",offset:[10,10]},{default:t(()=>[v(" Nuevo servicio ")]),_:1})]),_:1})):N("",!0)])]),e.addService?(D(),ge("div",De,[s("div",Pe,[a(E,{rounded:""},{default:t(()=>[a(_e,null,{default:t(()=>[Fe,s("div",Ye,[s("div",Ue,[a(V,{options:e.productos,"option-label":"producto",modelValue:e.service.producto,"onUpdate:modelValue":i[1]||(i[1]=l=>e.service.producto=l),label:"Producto","emit-value":"",rules:[l=>!!l||"* Campo obligatorio"]},null,8,["options","modelValue","rules"])]),s("div",Le,[a(V,{modelValue:e.service.client,"onUpdate:modelValue":i[2]||(i[2]=l=>e.service.client=l),"model-value":e.service.client,"hide-selected":"","fill-input":"","use-input":"","input-debounce":"0",options:e.clientes,"option-label":"legalname",onFilter:e.filterFn,"emit-value":"",label:"Cliente"},{"no-option":t(()=>[a(F,null,{default:t(()=>[a(Y,{class:"text-grey"},{default:t(()=>[v(" Sin resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","model-value","options","onFilter"])]),s("div",Me,[a(V,{modelValue:e.service.planta,"onUpdate:modelValue":i[3]||(i[3]=l=>e.service.planta=l),"model-value":e.service.planta,"hide-selected":"","fill-input":"","use-input":"","input-debounce":"0",options:e.plantas,"option-label":"alias",onFilter:e.filterPlanta,"emit-value":"",label:"Planta"},{"no-option":t(()=>[a(F,null,{default:t(()=>[a(Y,{class:"text-grey"},{default:t(()=>[v(" Sin resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","model-value","options","onFilter"])]),s("div",Te,[a(V,{modelValue:e.service.owner,"onUpdate:modelValue":i[4]||(i[4]=l=>e.service.owner=l),"model-value":e.service.owner,"hide-selected":"","fill-input":"","use-input":"","input-debounce":"0",options:e.owners,"option-label":"label",onFilter:e.filterStaff,label:"Responsable"},{"no-option":t(()=>[a(F,null,{default:t(()=>[a(Y,{class:"text-grey"},{default:t(()=>[v(" Sin resultados ")]),_:1})]),_:1})]),_:1},8,["modelValue","model-value","options","onFilter"])]),s("div",Ie,[a(we,{label:"Acepta reconocimiento",modelValue:e.service.recognition,"onUpdate:modelValue":i[5]||(i[5]=l=>e.service.recognition=l)},null,8,["modelValue"])])]),s("div",je,[s("div",Ae,[a(w,{filled:"",modelValue:e.service.date_recognition,"onUpdate:modelValue":i[7]||(i[7]=l=>e.service.date_recognition=l),mask:"date",label:"Inicio de reconocimiento",readonly:!e.service.recognition},{append:t(()=>[a(b,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(U,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(L,{modelValue:e.service.date_recognition,"onUpdate:modelValue":i[6]||(i[6]=l=>e.service.date_recognition=l),readonly:!e.service.recognition},{default:t(()=>[s("div",Be,[P(a(f,{label:"Close",color:"primary",flat:""},null,512),[[M]])])]),_:1},8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1},8,["modelValue","readonly"])]),s("div",Oe,[a(w,{filled:"",modelValue:e.service.date_start,"onUpdate:modelValue":i[9]||(i[9]=l=>e.service.date_start=l),mask:"date",rules:["date"],label:"Inicio de ejecuci\xF3n"},{append:t(()=>[a(b,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(U,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(L,{modelValue:e.service.date_start,"onUpdate:modelValue":i[8]||(i[8]=l=>e.service.date_start=l)},{default:t(()=>[s("div",Re,[P(a(f,{label:"Close",color:"primary",flat:""},null,512),[[M]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",$e,[a(w,{filled:"",modelValue:e.service.date_end,"onUpdate:modelValue":i[11]||(i[11]=l=>e.service.date_end=l),mask:"date",rules:["date"],label:"Fin de ejecuci\xF3n"},{append:t(()=>[a(b,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(U,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(L,{modelValue:e.service.date_end,"onUpdate:modelValue":i[10]||(i[10]=l=>e.service.date_end=l)},{default:t(()=>[s("div",Ne,[P(a(f,{label:"Close",color:"primary",flat:""},null,512),[[M]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",Ee,[a(f,{label:"guardar",color:"primary",onClick:e.saveService},null,8,["onClick"])])]),_:1})]),_:1})])])):N("",!0),s("div",ze,[s("div",Ge,[s("div",Je,[a(E,{rounded:""},{default:t(()=>[a(be,{title:"Servicios",rows:e.servicesList,columns:e.columns,filter:e.filter,"row-key":"id",onRowClick:e.goTo},{"top-right":t(()=>[a(w,{borderless:"",dense:"",debounce:"300",modelValue:e.filter,"onUpdate:modelValue":i[12]||(i[12]=l=>e.filter=l),placeholder:"Buscar"},{append:t(()=>[a(b,{name:"search"})]),_:1},8,["modelValue"])]),"body-cell-client_id":t(l=>[a(J,{props:l,class:"text-center"},{default:t(()=>[a(G,{outline:"",square:"",color:"primary","text-color":"white",class:"text-center"},{default:t(()=>[v(z(l.row.active==null?"Principal":"Planta"),1)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-status":t(l=>[a(J,{props:l,class:"text-center"},{default:t(()=>[a(G,{outline:"",square:"",color:l.row.status?"primary":"grey","text-color":"white",class:"text-center"},{default:t(()=>[v(z(l.row.status?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","filter","onRowClick"])]),_:1})])])])]),_:1})}var pa=ce(Qe,[["render",Ke]]);export{pa as default};
