import{Q as I,a as ke}from"./QBreadcrumbs.e2923fe3.js";import{r as i,g as Se,_ as Qe,k as Ue,bf as Ae,a as De,w as S,o as Ee,n as M,A as z,q as s,u as n,j as l,K as P,aD as p,L as d,bg as Fe,D as c,J as y,y as O,x as ee,bm as H,ah as K,b6 as J}from"./index.402e5cb0.js";import{Q as ae}from"./QTooltip.df6a31f4.js";import{Q as le,a as oe}from"./QTable.1c2883e8.js";import{Q as te}from"./QForm.d34d74a1.js";import{b as W}from"./QSelect.03ac91b0.js";import{b as se,Q as ne}from"./QItem.da63a453.js";import{Q as Pe}from"./QPage.fbc5bef6.js";import{C as X}from"./ClosePopup.81ec631a.js";import{u as Oe}from"./useClientes.f256c5cc.js";import{u as Ne}from"./use-quasar.12cbe038.js";import"./position-engine.b4a4220a.js";import"./QList.2b113048.js";import"./QMarkupTable.dab9a1ee.js";import"./format.d9704788.js";const $e=()=>!0;function Ge(e){const o={};return e.forEach(r=>{o[r]=$e}),o}function Y(){const{emit:e,proxy:o}=Se(),r=i(null);function Q(){r.value.show()}function C(){r.value.hide()}function q(w){e("ok",w),C()}function a(){e("hide")}return Object.assign(o,{show:Q,hide:C}),{dialogRef:r,onDialogHide:a,onDialogOK:q,onDialogCancel:C}}const ie=["ok","hide"];Y.emits=ie;Y.emitsObject=Ge(ie);["Google","Facebook","Twitter","Apple","Oracle"].reduce((e,o)=>{for(let r=1;r<=5;r++)e.push(o+" "+r);return e},[]);const Te=Ue({name:"clientePage",setup(){const e=Ne(),o=Ae(),{getCities:r,getStates:Q,fetchClient:C,getMainClient:q,addFactory:a,newAddress:w,updateClient:de,editClient:N,clientesPrincipales:$,cities:Z,states:G,createContact:re}=Oe();Y();const ue=De(()=>N),U=i([]),A=i([]),T=i([]),x=i(!0),D=i(null),h=i(null),f=i(null),ce=i(!1),V=i(!1),E=i(""),g=i({}),_=i(null),k=i(!1),v=i(!1),m=i({plantas:[]}),b=i({}),L=i(!1),me=[{name:"id",label:"Id",field:"id",align:"center"},{name:"alias",label:"Planta",field:"alias",align:"center",sortable:!0,sortOrder:"ad"},{name:"domicilio",label:"Domicilio",field:"domicilio",align:"center"},{name:"acciones",label:"Acciones",align:"left"}],pe=[{name:"id",label:"Id",field:"contact_id",align:"center"},{name:"name",label:"Nombre",field:"contact_name",align:"center",sortable:!0,sortOrder:"ad"},{name:"position",label:"Cargo",field:"contact_position",align:"center"},{name:"phone",label:"Tel\xE9fono",field:"contact_phone",align:"center"},{name:"extension",label:"Extensi\xF3n",field:"contact_ext",align:"center"},{name:"movil",label:"Movil",field:"contact_movil",align:"center"},{name:"mail",label:"E-mail",field:"contact_mail",align:"center"},{name:"acciones",label:"Acciones",align:"left"}];S($,t=>{T.value=t}),S(ue,t=>{m.value=t});const fe=async t=>{await q({cliente:t}),D.value=t,console.log(D)};S(h,async t=>{v.value||(f.value=null),t!=null&&await r(t.id),console.log("ciudades_a",A.value),console.log("city selected",f.value)});const ge=(t,u,R)=>{u(()=>{t.toLocaleLowerCase(),T.value=$.value,console.log($)})},ve=(t,u,R)=>{console.log(t),u(()=>{if(t==="")U.value=G.value;else{const j=t.toLowerCase();U.value=G.value.filter(B=>B.estado.toLowerCase().indexOf(j)>-1)}})},be=(t,u,R)=>{u(()=>{if(t==="")A.value=Z.value;else{const j=t.toLowerCase();A.value=Z.value.filter(B=>B.ciudad.toLowerCase().indexOf(j)>-1)}})},Ce=async(t,u,R)=>{await q({cliente:D.value})},Ve=async()=>{E.value!=""&&(await a({alias:E.value,client_id:m.value.id})).status==200&&(E.value="",e.notify({position:"top",type:"positive",message:"Se agreg\xF3 una nueva planta"}),await F())},F=async()=>{await C(o.params.id),m.value=N.value,x.value=N.value.client_id==null,L.value=m.value.status==1},ye=()=>{e.dialog({title:v.value?"\xBFDeseas modificar esta direcci\xF3n?":"Agregar direcci\xF3n",message:"Se guardar\xE1n los datos ingresados",ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async t=>{g.value.client_id=_.value.id,g.value.city_id=f.value.id,(await w(g.value)).status==200?(await F(),e.notify({position:"top",type:"positive",message:v.value?"Se modific\xF3 la direcci\xF3n":"Se agreg\xF3 una nueva direcci\xF3n"})):e.notify({position:"top",type:"negative",message:"Hubo un error al guardar la direcci\xF3n"}),v.value=!1,g.value={},f.value={},h.value={},_.value=null,V.value=!1}).onCancel(()=>{}).onDismiss(()=>{})},qe=t=>{_.value=t.alias,V.value=!0,v.value=!0,g.value=t,f.value={id:t.cityid,ciudad:t.citydsc,city_id:t.cityid},h.value={id:t.stateid,estado:t.statedsc}};S(V,t=>{V.value||(v.value=!1,g.value={},f.value=null,h.value=null,_.value=null,V.value=!1)});const we=async()=>{e.dialog({title:"\xBFDeseas modificar la informaci\xF3n del cliente?",message:"Se guardar\xE1n los datos ingresados",ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async t=>{const u=await de({id:m.value.id,legalname:m.value.legalname,business_description:m.value.business_description,rfc:m.value.rfc,status:L.value});u.response&&u.response.data.errors&&e.notify({position:"top",type:"negative",message:"El RFC ingresado corresponde a otro cliente"}),u.status==200&&(e.notify({position:"top",type:"positive",message:"El cliente se actualiz\xF3 correctamente"}),getClients(),newClient.value={})})},he=t=>{b.value=t,k.value=!0};S(k,t=>{k.value||(b.value={}),console.log(b.value)});const _e=async()=>{e.dialog({title:"\xBFDeseas continuar?",message:"Se guardar\xE1n los datos ingresados",ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async t=>{if(b.value.client_id=m.value.id,(await re(b.value)).status==200)e.notify({position:"top",type:"positive",message:"El cliente se actualiz\xF3 correctamente"});else return e.notify({position:"top",type:"negative",message:"Error al crear contacto"}),!1;k.value=!1,b.value={},await F()})};return Ee(async()=>{await r(),await Q(),U.value=G.value,o.params.id&&await F()}),{dataClient:m,clienteSelected:D,clientes:T,citySelected:f,stateSelected:h,isMain:x,ciudades:A,estados:U,addPlanta:ce,plantaName:E,addAddress:V,address:g,factory:_,addressColumn:me,disableFactory:v,addContact:k,contact:b,contactColumns:pe,statusClient:L,setModel:fe,searchClient:Ce,filterFn:ge,filterState:ve,filterCity:be,plantaAdd:Ve,addressAdd:ye,editAddress:qe,updateRFC:we,saveContact:_e,editContact:he}}}),Le={class:"q-pa-md q-gutter-sm"},Re=n("span",{class:"text-h6 q-ml-sm"}," Cliente ",-1),je={class:"row q-mb-lg"},Be={class:"col-xs-11 col-sm-4 q-pa-sm"},Ie={class:"col-xs-11 col-sm-4 q-pa-sm"},Me={class:"col-xs-11 col-sm-4 q-pa-sm"},ze={class:"col-xs-11 col-sm-4 q-pa-sm"},He={class:"row q-pl-sm"},Ke=n("span",{class:"text-h6 q-ml-sm"}," Plantas ",-1),Je={class:"row q-mb-lg q-pa-sm"},We={class:"q-pa-sm q-mb-lg"},Xe=n("span",{class:"text-h6 q-ml-sm"}," Contactos ",-1),Ye={class:"row q-mb-lg q-pa-sm"},Ze={class:"q-pa-sm q-mb-lg"},xe=n("span",{class:"text-h6 q-ml-sm"}," Contacto ",-1),ea={class:"row q-mb-lg"},aa={class:"col-md-4 q-pa-sm"},la={class:"col-md-4 q-pa-sm"},oa={class:"col-md-4 q-pa-sm"},ta={class:"row q-mb-lg"},sa={class:"col-md-4 q-pa-sm"},na={class:"col-md-4 q-pa-sm"},ia={class:"col-md-4 q-pa-sm"},da={class:"q-mb-lg"},ra={class:"col-xs-11 col-sm-4 q-pa-sm"},ua={class:"col-xs-11 col-sm-4 q-pa-sm"},ca={class:"col-xs-11 col-sm-4 q-pa-sm"},ma={class:"col-xs-11 col-sm-4 q-pa-sm"},pa={class:"col-xs-11 col-sm-4 q-pa-sm"},fa={class:"col-xs-11 col-sm-4 q-pa-sm"},ga={class:"col-xs-11 col-sm-4 q-pa-sm"},va={class:"col-xs-11 col-sm-4 q-pa-sm"};function ba(e,o,r,Q,C,q){return M(),z(Pe,{class:"q-pa-sm"},{default:s(()=>[n("div",Le,[l(ke,null,{default:s(()=>[l(I,{icon:"home",to:{name:"index-admin"}}),l(I,{label:"Clientes",icon:"domain",to:{name:"clientes"}}),l(I,{label:"Cliente",icon:"domain"})]),_:1})]),l(y,null,{default:s(()=>[l(P,null,{default:s(()=>[l(p,{class:"q-ml-sm q-mr-sm separador"}),Re,l(p,{class:"q-mb-lg q-ml-sm q-mr-sm separador"}),n("div",je,[n("div",Be,[l(d,{modelValue:e.dataClient.legalname,"onUpdate:modelValue":o[0]||(o[0]=a=>e.dataClient.legalname=a),label:"Raz\xF3n social"},null,8,["modelValue"])]),n("div",Ie,[l(d,{modelValue:e.dataClient.rfc,"onUpdate:modelValue":o[1]||(o[1]=a=>e.dataClient.rfc=a),maxlength:"13",rules:[a=>!!a||"* Campo obligatorio"],label:"RFC"},null,8,["modelValue","rules"])]),n("div",Me,[l(d,{modelValue:e.dataClient.business_description,"onUpdate:modelValue":o[2]||(o[2]=a=>e.dataClient.business_description=a),label:"Descripci\xF3n giro comercial"},null,8,["modelValue"])]),n("div",ze,[l(Fe,{color:"primary",modelValue:e.statusClient,"onUpdate:modelValue":o[3]||(o[3]=a=>e.statusClient=a),val:e.statusClient,label:"Estatus cliente"},null,8,["modelValue","val"])])]),n("div",He,[l(c,{label:"Guardar",color:"primary",onClick:e.updateRFC},null,8,["onClick"])]),l(p,{class:"q-ml-sm q-mr-sm q-mt-md separador"}),Ke,l(p,{class:"q-mb-lg q-mr-sm q-ml-sm separador"}),n("div",Je,[l(c,{color:"primary",class:"q-mr-sm",outline:"",onClick:o[4]||(o[4]=a=>e.addPlanta=!0),label:"Agregar planta"}),l(c,{color:"primary",class:"q-ml-sm",outline:"",onClick:o[5]||(o[5]=a=>e.addAddress=!0),label:"Agregar direcci\xF3n"})]),n("div",We,[l(y,null,{default:s(()=>[l(le,{rows:e.dataClient.plantas,columns:e.addressColumn},{"body-cell-acciones":s(a=>[l(oe,{props:a,class:"text-center"},{default:s(()=>[a.row.address_id!=null?(M(),z(c,{key:0,color:"warning",outline:"",label:"editar",onClick:w=>e.editAddress(a.row)},{default:s(()=>[l(ae,{anchor:"center left",self:"center left",offset:[10,10]},{default:s(()=>[O(" Editar direcci\xF3n ")]),_:1})]),_:2},1032,["onClick"])):ee("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})]),l(p,{class:"q-ml-sm q-mr-sm separador"}),Xe,l(p,{class:"q-mb-lg q-mr-sm q-ml-sm separador"}),n("div",Ye,[l(c,{color:"primary",class:"q-mr-sm",outline:"",onClick:o[6]||(o[6]=a=>e.addContact=!0),label:"Agregar contacto"})]),n("div",Ze,[l(y,null,{default:s(()=>[l(le,{rows:e.dataClient.contactos,columns:e.contactColumns},{"body-cell-acciones":s(a=>[l(oe,{props:a,class:"text-center"},{default:s(()=>[a.row.contact_id!=null?(M(),z(c,{key:0,color:"warning",outline:"",label:"editar",onClick:w=>e.editContact(a.row)},{default:s(()=>[l(ae,{anchor:"center left",self:"center left",offset:[10,10]},{default:s(()=>[O(" Editar contacto ")]),_:1})]),_:2},1032,["onClick"])):ee("",!0)]),_:2},1032,["props"])]),_:1},8,["rows","columns"])]),_:1})])]),_:1})]),_:1}),l(J,{modelValue:e.addPlanta,"onUpdate:modelValue":o[8]||(o[8]=a=>e.addPlanta=a),ref:"planta","transition-show":"flip-down","transition-hide":"flip-up",persistent:""},{default:s(()=>[l(y,{class:"q-dialog-plugin"},{default:s(()=>[l(P,null,{default:s(()=>[l(d,{modelValue:e.plantaName,"onUpdate:modelValue":o[7]||(o[7]=a=>e.plantaName=a),label:"Planta"},null,8,["modelValue"])]),_:1}),l(H,{align:"right"},{default:s(()=>[K(l(c,{color:"primary",label:"Cancelar"},null,512),[[X]]),l(c,{color:"primary",label:"Guardar",onClick:e.plantaAdd},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:e.addContact,"onUpdate:modelValue":o[15]||(o[15]=a=>e.addContact=a),ref:"contacto","transition-show":"flip-down","transition-hide":"flip-up",persistent:""},{default:s(()=>[l(y,{class:"q-dialog-plugin",style:{"max-width":"1500px",width:"1000px",height:"150px","min-height":"370px"}},{default:s(()=>[l(te,{onSubmit:e.saveContact},{default:s(()=>[l(P,null,{default:s(()=>[l(p,{class:"q-ml-sm q-mr-sm separador"}),xe,l(p,{class:"q-mb-sm q-ml-sm q-mr-sm separador"}),n("div",ea,[n("div",aa,[l(d,{modelValue:e.contact.contact_name,"onUpdate:modelValue":o[9]||(o[9]=a=>e.contact.contact_name=a),label:"Nombre contacto",rules:[a=>!!a||"* Campo obligatorio"]},null,8,["modelValue","rules"])]),n("div",la,[l(d,{modelValue:e.contact.contact_position,"onUpdate:modelValue":o[10]||(o[10]=a=>e.contact.contact_position=a),label:"Cargo contacto",rules:[a=>!!a||"* Campo obligatorio"]},null,8,["modelValue","rules"])]),n("div",oa,[l(d,{modelValue:e.contact.contact_phone,"onUpdate:modelValue":o[11]||(o[11]=a=>e.contact.contact_phone=a),label:"Tel\xE9fono contacto",mask:"##-##-##-##-##",rules:[a=>!!a||"* Campo obligatorio"]},null,8,["modelValue","rules"])])]),n("div",ta,[n("div",sa,[l(d,{modelValue:e.contact.contact_ext,"onUpdate:modelValue":o[12]||(o[12]=a=>e.contact.contact_ext=a),label:"Extensi\xF3n"},null,8,["modelValue"])]),n("div",na,[l(d,{modelValue:e.contact.contact_movil,"onUpdate:modelValue":o[13]||(o[13]=a=>e.contact.contact_movil=a),mask:"##-##-##-##-##",label:"Movil"},null,8,["modelValue"])]),n("div",ia,[l(d,{modelValue:e.contact.contact_mail,"onUpdate:modelValue":o[14]||(o[14]=a=>e.contact.contact_mail=a),label:"E-mail",type:"email"},null,8,["modelValue"])])])]),_:1}),l(H,{class:"q-pa-lg justify-end"},{default:s(()=>[K(l(c,{color:"primary",label:"Cancelar"},null,512),[[X]]),l(c,{color:"primary",label:"Guardar",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"]),l(J,{modelValue:e.addAddress,"onUpdate:modelValue":o[24]||(o[24]=a=>e.addAddress=a),ref:"domicilio",persistent:""},{default:s(()=>[l(y,{class:"q-dialog-plugin"},{default:s(()=>[l(te,{onSubmit:e.addressAdd},{default:s(()=>[l(P,null,{default:s(()=>[n("div",da,[n("div",ra,[l(W,{options:e.dataClient.plantas,"option-label":"alias",modelValue:e.factory,"onUpdate:modelValue":o[16]||(o[16]=a=>e.factory=a),label:"Planta","emit-value":"",disable:e.disableFactory,rules:[a=>!!a||"* Campo obligatorio"]},null,8,["options","modelValue","disable","rules"])]),n("div",ua,[l(d,{modelValue:e.address.street,"onUpdate:modelValue":o[17]||(o[17]=a=>e.address.street=a),label:"Calle",rules:[a=>!!a||"* Campo obligatorio"]},null,8,["modelValue","rules"])]),n("div",ca,[l(d,{modelValue:e.address.number,"onUpdate:modelValue":o[18]||(o[18]=a=>e.address.number=a),label:"N\xFAmero"},null,8,["modelValue"])]),n("div",ma,[l(d,{modelValue:e.address.apartment_number,"onUpdate:modelValue":o[19]||(o[19]=a=>e.address.apartment_number=a),label:"N\xFAmero interior"},null,8,["modelValue"])]),n("div",pa,[l(d,{maxlength:"5",modelValue:e.address.zipcode,"onUpdate:modelValue":o[20]||(o[20]=a=>e.address.zipcode=a),label:"C\xF3digo postal",rules:[a=>!!a||"* Campo obligatorio"]},null,8,["modelValue","rules"])]),n("div",fa,[l(d,{modelValue:e.address.neighborhood,"onUpdate:modelValue":o[21]||(o[21]=a=>e.address.neighborhood=a),label:"Colonia",rules:[a=>!!a||"* Campo obligatorio"]},null,8,["modelValue","rules"])]),n("div",ga,[l(W,{"model-value":e.stateSelected,modelValue:e.stateSelected,"onUpdate:modelValue":o[22]||(o[22]=a=>e.stateSelected=a),"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Estado",options:e.estados,"option-label":"estado","option-value":"id",onFilter:e.filterState,rules:[a=>!!a||"* Campo obligatorio"]},{"no-option":s(()=>[l(se,null,{default:s(()=>[l(ne,{class:"text-grey"},{default:s(()=>[O(" No results ")]),_:1})]),_:1})]),_:1},8,["model-value","modelValue","options","onFilter","rules"])]),n("div",va,[l(W,{"model-value":e.citySelected,modelValue:e.citySelected,"onUpdate:modelValue":o[23]||(o[23]=a=>e.citySelected=a),"use-input":"","hide-selected":"","fill-input":"","input-debounce":"0",label:"Ciudad",options:e.ciudades,"option-label":"ciudad","option-value":"id",onFilter:e.filterCity,rules:[a=>!!a||"* Campo obligatorio"]},{"no-option":s(()=>[l(se,null,{default:s(()=>[l(ne,{class:"text-grey"},{default:s(()=>[O(" Sin resultados ")]),_:1})]),_:1})]),_:1},8,["model-value","modelValue","options","onFilter","rules"])])])]),_:1}),l(H,{align:"right"},{default:s(()=>[K(l(c,{color:"primary",label:"Cancelar"},null,512),[[X]]),l(c,{color:"primary",label:"Guardar",type:"submit"})]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Pa=Qe(Te,[["render",ba]]);export{Pa as default};
