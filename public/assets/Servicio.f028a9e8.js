import{Q as Me,a as xe}from"./QBreadcrumbs.e2923fe3.js";import{E as Ye,a as R,h as ne,a7 as ea,k as be,bt as Re,r as d,w as W,o as he,_ as ye,n as y,p as Y,j as a,q as t,J as de,K,aD as ce,u as s,L as M,Q as re,ah as ge,D as $,y as P,F as ie,v as me,x as Z,bu as Ae,bg as Pe,A as x,b6 as je,bv as aa,z,bw as la,bx as oa,al as Ce,ak as De,bm as sa,g as Be,aO as ta,U as Ge,aK as ia,aW as ra,a_ as na,aX as da,aZ as ua,a$ as ca,by as ma,b0 as Qe,be as va,aY as pa,aG as fa,bf as ga}from"./index.402e5cb0.js";import{Q as A}from"./QTooltip.df6a31f4.js";import{Q as ke,d as pe,a as Ie}from"./QPopupProxy.a31a017a.js";import{Q as _a}from"./QPage.fbc5bef6.js";import{C as _e}from"./ClosePopup.81ec631a.js";import{u as Ve}from"./use-quasar.12cbe038.js";import{u as qe}from"./useUsers.3dcbe72b.js";import{u as we}from"./useServicios.d1a31ea0.js";import{b as X,Q as ba}from"./QSelect.03ac91b0.js";import{Q as He,a as Fe}from"./QTable.1c2883e8.js";import{Q as Le,u as ze,w as ha}from"./xlsx.7ebc4d61.js";import{Q as ya}from"./QSpace.5ea5219b.js";import{h as Va}from"./format.d9704788.js";import{Q as qa}from"./QSpinnerDots.8dea9e2b.js";import"./position-engine.b4a4220a.js";import"./QItem.da63a453.js";import"./QList.2b113048.js";import"./QMarkupTable.dab9a1ee.js";import"./TouchPan.a2e86cc2.js";const wa=["top","middle","bottom"];var oe=Ye({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:e=>wa.includes(e)}},setup(e,{slots:o}){const b=R(()=>e.align!==void 0?{verticalAlign:e.align}:null),C=R(()=>{const f=e.outline===!0&&e.color||e.textColor;return`q-badge flex inline items-center no-wrap q-badge--${e.multiLine===!0?"multi":"single"}-line`+(e.outline===!0?" q-badge--outline":e.color!==void 0?` bg-${e.color}`:"")+(f!==void 0?` text-${f}`:"")+(e.floating===!0?" q-badge--floating":"")+(e.rounded===!0?" q-badge--rounded":"")+(e.transparent===!0?" q-badge--transparent":"")});return()=>ne("div",{class:C.value,style:b.value,role:"status","aria-label":e.label},ea(o.default,e.label!==void 0?[e.label]:[]))}});const $a=be({name:"Areas",props:["show","servicio_id","departamento_id","idArea","infoEdit"],emits:["closeModal","submit"],setup(e,o){const b=Ve();qe();const C=we(),{saveAreaPayload:f,tableA1:q,getDepartments:l}=C,c=Re(e,"show"),n=d(c==!0),E=d(),N=d(),I=d([]),O=d(!1),g=(v,F)=>{b.notify({position:"top",type:F,message:v})},T=R(v=>v?(v=v.toString(),v.charAt(0).toUpperCase()+v.slice(1)):""),i=d({closeWindow:!1,area:"",recurrencia:"",total_luminarias:0,horarios:[],luminarias:[],horario_estudio:"",areas_iluminadas:[],estudio_por:"",zonas:"",x:"",y:"",h:"",ic:"",revisa:"",elabora:"",question1:!1,question2:!1,question3:!1,service_id:0,department_id:0,puntos_medicion:0,observaciones:"Ninguna"}),Q=d(["Primero","Segundo","Tercero","Mixto"]),h=d({tipo:"",inicio:"00:00",final:"00:00"}),r=d({show:!1,primero:!1,segundo:!1,tercero:!1,mixto:!1}),U=d([]),w=d(["Fluorecente","LED","Descarga","Antichispa","Aditivo met\xE1lico","Otro"]),V=d(["No se requiere","Si se requiere","Ya utiliza luminarias localizadas"]),u=d({tipo:"",cantidad:0,lamparas:0,potencia:0}),_=d(0),D=()=>{if(i.value.horarios.length>=4)return g("Todos los horarios est\xE1n completos","negative"),!1;if(h.value.tipo==="")return g("Por favor selecciona el tipo de hoario","negative"),!1;if(E.hasError||N.hasError)return g("Por favor ingresa un horario v\xE1lido","negative"),!1;if(r.value.primero&&h.value.tipo=="Primero"||r.value.segundo&&h.value.tipo=="Segundo"||r.value.tercero&&h.value.tipo=="Tercero"||r.value.mixto&&h.value.tipo=="Mixto")return g("El horario seleccionado ya existe","negative"),!1;r.value.show=!0,h.value.tipo==="Primero"?r.value.primero=!0:h.value.tipo==="Segundo"?r.value.segundo=!0:h.value.tipo==="Tercero"?r.value.tercero=!0:r.value.mixto=!0,U.value.push({label:h.value.tipo,value:h.value.tipo}),i.value.horarios.push(h.value),console.log(i.value.horarios),g("Se agreg\xF3 horario","positive"),h.value={tipo:"",inicio:"00:00",final:"00:00"}},m=v=>{i.value.horarios.map((F,le)=>{F.tipo==v&&(i.value.horarios.splice(le,1),v=="Primero"?r.value.primero=!1:v=="Segundo"?r.value.segundo=!1:v=="Tercero"?r.value.tercero=!1:r.value.mixto=!1),console.log(r.value)})},k=d([{value:"puesto_trabajo",label:"Puesto de trabajo"},{value:"area",label:"\xC1rea de trabajo"},{value:"ambos",label:"Ambos"}]),B=d([{value:"plano",label:"Plano de trabajo"},{value:"pared",label:"Pared"},{value:"ambos",label:"Ambos"}]),ae=d([{value:"lisa",label:"Lisa"},{value:"rugosa",label:"Rugosa"},{value:"ambas",label:"Ambas"}]),H=d([{label:"Amarillo",valor:1},{label:"Azul Claro",valor:2},{label:"Azul oscuro",valor:3},{label:"Blanco",valor:4},{label:"Crema",valor:5},{label:"Gris claro",valor:6},{label:"Gris oscuro",valor:7},{label:"Marr\xF3n claro",valor:8},{label:"Marr\xF3n oscuro",valor:9},{label:"Negro",valor:10},{label:"Plateado",valor:11},{label:"Rosa Claro",valor:12},{label:"Rosa oscuro",valor:13},{label:"Verde claro",valor:14},{label:"Verde oscuro",valor:15},{label:"Vino",valor:16},{label:"Otro",valor:17}]),G=d([{label:"Acabado ep\xF3xico",valor:"A"},{label:"Azulejo",valor:"B"},{label:"Block",valor:"C"},{label:"Concreto",valor:"D"},{label:"Cartulina sulfatada",valor:"E"},{label:"Estuco",valor:"F"},{label:"Formaica",valor:"G"},{label:"Granito",valor:"H"},{label:"Pl\xE1stico",valor:"I"},{label:"Ladrillo",valor:"J"},{label:"Loseta",valor:"K"},{label:"Madera",valor:"L"},{label:"M\xE1rmol",valor:"M"},{label:"Metal",valor:"N"},{label:"Tablaroca",valor:"\xD1"},{label:"Tela",valor:"O"},{label:"Otro",valor:"P"}]),J=["Buena","Regular","Mala"],ue=d(["Otto Finck S\xE1nchez","Juan Jos\xE9 Sandoval Galindo","Miguel Joaquin Jacinto","Edgar Sandoval Balderas","Itzel Sandoval Galindo","Alejandra Lazcano Ramos","Navil Becerril L\xF3pez","Nayeli de Le\xF3n Hern\xE1ndez"]),p=d({puesto_trabajo:"",color_material:[],colorMaterial:"",superficie_plano:"",superficie_pared:"",condicion_iluminacion:"",tarea_visual:"",trabajadores:0,tareas:0,descripcion:"No requiere",cambiarNombre:!1}),j=d(""),L=d(""),te=d(0),S=d([]);W(c,v=>{n.value=v,e.infoEdit!=null&&(i.value=e.infoEdit,i.value.horarios&&i.value.horarios.length>0&&(r.value.show=!0,i.value.horarios.map(F=>{F.tipo=="Primero"&&(r.value.primero=!0),F.tipo=="Segundo"&&(r.value.segundo=!0),F.tipo=="Tercero"&&(r.value.tercero=!0),F.tipo=="Mixto"&&(r.value.mixto=!0)})))},{deep:!0}),W(n,v=>{v||o.emit("closeModal",!1)}),W(j,v=>{console.log(v)}),W(()=>i.value.x,(v,F)=>{ee()}),W(()=>i.value.y,(v,F)=>{ee()}),W(()=>i.value.h,(v,F)=>{ee()});const ee=()=>{if(i.value.x!=""&&i.value.y!=""&&i.value.h!=""){const v=i.value.x*i.value.y,F=Number(i.value.h)*(Number(i.value.x)+Number(i.value.y));i.value.ic=v/F,i.value.ic=i.value.ic.toFixed(2),I.value=[],i.value.ic<1?I.value=[4,6]:i.value.ic>=1&&i.value.ic<2?I.value=[9,12]:i.value.ic>=2&&i.value.ic<=3?I.value=[16,20]:3<i.value.ic&&(I.value=[25,30])}else i.value.ic=0,I.value=[]},ve=()=>{if(_.value=0,i.value.total_luminarias===0)return g("Por favor indica un n\xFAmero de luminarias mayor a cero","negative"),!1;if(u.value.tipo==="")return g("Por favor selecciona el tipo de luminaria","negative"),!1;if(i.value.luminarias.forEach(v=>{_.value=_.value+v.cantidad}),_.value=_.value+u.value.cantidad,_.value>i.value.total_luminarias)return g("Se alcanz\xF3 el total de luminarias indicadas","negative"),!1;if(u.value.cantidad>0)u.value.cantidad=parseInt(u.value.cantidad,10),u.value.lamparas=parseInt(u.value.lamparas,10),u.value.potencia=parseInt(u.value.potencia,10),i.value.luminarias.push(u.value),u.value={tipo:"",cantidad:0,lamparas:0,potencia:0};else return g("Por favor indica una cantidad mayor a cero","negative"),!1},$e=v=>{i.value.luminarias.forEach(F=>{_.value=_.value-F.cantidad}),i.value.luminarias=i.value.luminarias.filter((F,le)=>v!==le)},Ee=v=>{if(v==="color-material"&&j.value.valor!=null&&j.value.valor!=""&&L.value.valor!=null&&L.value.valor!=""||L.value.otro_valor!=null&&L.value.otro_valor!=""||j.value.otro_valor!=null&&j.value.otro_valor!="")return p.value.colorMaterial===""?(g("Por favor indica pared o plano","negative"),!1):(p.value.color_material.push({tipo:p.value.colorMaterial,label:`${j.value.label}, ${L.value.label}`,value:`${j.value.valor}, ${L.value.valor}`,color_otro:`${j.value.otro_valor}`,material_otro:`${L.value.otro_valor}`}),g("Se agreg\xF3 color y material","positive"),j.value=L.value=p.value.colorMaterial="",!1);if(v==="guardar")return p.value.puesto_trabajo===""?(g("Por favor indica el puesto de trabajo","negative"),!1):(i.value.areas_iluminadas.push(p.value),p.value={puesto_trabajo:"",color_material:[],colorMaterial:"",superficie_plano:"",superficie_pared:"",condicion_iluminacion:"",tarea_visual:"",trabajadores:0,tareas:0,descripcion:"No requiere"},g("Se agreg\xF3 puesto de trabajo","positive"),!1);g("Sin valores especificados","negative")},Se=(v,F)=>{p.value.color_material=p.value.color_material.filter((le,Te)=>v!==Te)},Oe=v=>{i.value.areas_iluminadas=i.value.areas_iluminadas.filter((F,le)=>v!==le)},Je=async()=>{console.log(e.servicio_id),i.value.service_id=i.value.service_id>0?i.value.service_id:e.servicio_id,i.value.department_id=i.value.department_id>0?i.value.department_id:e.departamento_id,Xe()&&b.dialog({title:"\xBFDeseas guardar los cambios?",message:"Se guardar\xE1n los datos ingresados",ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async v=>{console.log("entra a enviar",i.value),te.value=te.value+1,(await f({area_id:e.idArea,data:i.value})).status==200?(g("Se guard\xF3 el \xE1rea de forma correcta","positive"),_.value=0,await l({servicio_id:e.servicio_id}),e.idArea!=0&&Ne("save"),n.value=!1):g("Por favor contacta con el administrador","negative")})},Xe=()=>{if(i.value.area==="")return g("Ingresa un nombre de \xE1rea","negative"),!1;if(i.value.horarios.length===0)return g("Ingresa al menos un horario","negative"),!1;if(i.value.areas_iluminadas.length===0)return g("Ingresa al menos un puesto de trabajo","negative"),!1;i.value.puntos_medicion=0;let v=!0;return i.value.areas_iluminadas.forEach(F=>{i.value.puntos_medicion=i.value.puntos_medicion+parseInt(F.tareas),i.value.estudio_por==="puesto_trabajo"&&(F.tarea_visual===""||F.tareas===0)&&(g("Por favor indica las tareas visuales","negative"),v=!1),i.value.estudio_por==="puesto_trabajo"&&F.tareas>0&&F.trabajadores==0&&(g("Por favor indica el n\xFAmero de trabajadores","negative"),v=!1)}),v?i.value.revisa===""||i.value.elabora===""?(g("Por favor selecciona a los responsables","negative"),!1):!0:!1},Ke=()=>{b.dialog({title:"\xBFSeguro que quieres cerrar la ventana?",message:"Se perder\xE1n todos los cambios y no ser\xE1 posible recuperarlos",ok:{push:!0,label:"Si, salir y borrar",color:"red-4"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async v=>{Ne(),n.value=!1})},We=v=>{S.value=v,O.value=!0},Ne=v=>{r.value={show:!1,primero:!1,segundo:!1,tercero:!1,mixto:!1},i.value={area:"",recurrencia:i.value.recurrencia,total_luminarias:0,horarios:i.value.horarios,luminarias:[],horario_estudio:i.value.horario_estudio,areas_iluminadas:[],estudio_por:"",zonas:"",x:"",y:"",h:"",ic:"",revisa:v=="save"?i.value.revisa:"",elabora:v=="save"?i.value.elabora:"",question1:!1,question2:!1,question3:!1,service_id:0,department_id:0,puntos_medicion:0,observaciones:"Ninguna"}},Ze=(v,F)=>{const le=d("");b.dialog({title:"Editar nombre puesto",message:"Puesto de trabajo",prompt:{model:le,type:"text"},ok:{push:!0,label:"Guardar",color:"primary"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(Te=>{le.value!=""&&(i.value.areas_iluminadas[v].puesto_trabajo=le)})};return he(()=>{n.value=c.value==!0,o.emit("closeModal",!1)}),{mostrar:c,areaData:i,horario:h,ver:n,turnos:Q,inicio:E,horarios:r,horarios_estudio:U,estudio_por_options:k,zonas:I,luminarias_tipo:w,luminaria_select:u,options_color_material:B,superficies:ae,colores:H,materiales:G,areaIluminada:p,condiciones:J,color:j,material:L,total_areas:te,puesto_mostrar:S,tableA1:q,capitalize:T,responsables_list:ue,descripciones:V,mostrarColores:O,addHorario:D,deleteHorario:m,addLuminaria:ve,deleteLuminaria:$e,addOptions:Ee,editNamePosition:Ze,showColors:We,saveArea:Je,deleteAreaIluminada:Oe,deleteColorMaterial:Se,resetModal:Ke}}}),se=e=>(la("data-v-3fe95c89"),e=e(),oa(),e),ka=se(()=>s("div",{class:"row q-pa-sm"},[s("span",{class:"text-h6"},"Agregar \xC1rea")],-1)),Ca={class:"row"},Da={class:"col-xs-12 col-sm-3"},Sa={class:"col-xs-12 col-sm-2 q-mr-lg"},Aa={class:"col-xs-12 col-sm-2 q-ml-md"},Ua={class:"row items-center justify-end"},Pa={class:"col-xs-12 col-sm-2 q-ml-sm"},ja={class:"row items-center justify-end"},Fa={class:"row items-center"},Ma={class:"col-xs-12 col-sm-4"},Ia={key:0,class:"row q-mt-lg"},za={class:"col-md-5 col-xs-12"},Ea=se(()=>s("p",{class:"text-subtitle2"},"Turno donde se localizan los niveles cr\xEDticos de iluminaci\xF3n:",-1)),Oa={class:"col-md-5 col-xs-12"},Na=se(()=>s("p",{class:"text-subtitle2"},"Se elige hacer por:",-1)),Ta={key:1,class:"row q-pa-sm q-mt-md"},Qa={class:"row q-pa-md q-mt-lg"},La={class:"col-md-3"},Ya={class:"col-md-3"},Ra=se(()=>s("div",{class:"row bg-green-11 rounded-borders justify-center q-pa-md"},[s("span",{class:"text-h4 text-teal"},"Luminarias")],-1)),Ba={class:"row q-pa-md q-mt-lg"},Ga={class:"col-sm-2 col-xs-12"},Ha={class:"col-sm-3 col-xs-12"},Ja={class:"col-sm-2 col-xs-12"},Xa={key:0,class:"col-sm-1"},Ka={class:"row q-pa-sm q-mt-sm"},Wa={class:"col-sm-3 col-xs-12"},Za={class:"col-sm-3 col-xs-12"},xa={class:"col-sm-3 col-xs-12"},el={class:"row q-ml-md q-mt-md"},al={id:"detalleLuminarias",class:"q-mt-md q-pa-md"},ll=["onDblclick"],ol=se(()=>s("div",{class:"row bg-green-11 rounded-borders justify-center q-pa-md"},[s("span",{class:"text-h4 text-teal"},"Descripci\xF3n del \xE1rea iluminada")],-1)),sl={class:"row q-pa-sm q-mt-md"},tl={class:"col-xs-12 col-md-2"},il={class:"col-md-3 q-mt-sm"},rl=se(()=>s("span",{class:"text-caption"},"Relaci\xF3n color-material:",-1)),nl={class:"col-md-3 col-xs-12"},dl={class:"col-md-3 col-xs-12"},ul={class:"col-md-1"},cl={id:"detalleColorMaterial",class:"row container"},ml=["onDblclick"],vl={class:"row q-pa-sm q-mt-md"},pl={class:"col-md-3"},fl=se(()=>s("label",null,"Plano de trabajo:",-1)),gl={class:"col-md-3"},_l=se(()=>s("label",null,"Pared:",-1)),bl={class:"col-md-2"},hl=se(()=>s("div",{class:"row bg-green-11 rounded-borders justify-center q-pa-md"},[s("span",{class:"text-h4 text-teal"},"Descripci\xF3n de las tareas visuales")],-1)),yl={class:"q-mb-sm q-mt-md"},Vl={class:"row"},ql={class:"col-md-4 align-self-center"},wl={class:"row inline q-pa-md"},$l={class:"row q-pa-sm"},kl={class:"col-md-2 col-xs-12"},Cl={class:"col-md-2 col-xs-12"},Dl={class:"col-md-4 col-xs-12"},Sl={class:"row q-pa-sm"},Al={class:"col-md-2 col-xs-12"},Ul={class:"col-md-2 col-xs-12"},Pl=se(()=>s("div",{class:"row bg-green-11 rounded-borders justify-center q-pa-md"},[s("span",{class:"text-h4 text-teal"},"Observaciones y responsables")],-1)),jl={class:"row q-pa-sm q-mt-md"},Fl={class:"col-md-3 col-xs-12"},Ml={class:"col-md-3 col-xs-12"},Il={class:"col-md-3 col-xs-12"},zl={class:"row justify-end q-pa-sm q-mt-md"},El={class:"row"},Ol={class:"col-md-12"},Nl={key:0},Tl={key:1};function Ql(e,o,b,C,f,q){return y(),Y(ie,null,[a(je,{modelValue:e.ver,"onUpdate:modelValue":o[38]||(o[38]=l=>e.ver=l),persistent:"","full-width":""},{default:t(()=>[a(de,{class:"q-dialog-plugin q-pa-md",style:{height:"90vh"}},{default:t(()=>[a(K,null,{default:t(()=>[ka,a(ce,{spaced:""}),s("div",Ca,[s("div",Da,[a(M,{label:"Nombre de \xE1rea",modelValue:e.areaData.area,"onUpdate:modelValue":o[0]||(o[0]=l=>e.areaData.area=l),class:"q-ml-sm",style:{"max-width":"280px"}},null,8,["modelValue"])]),s("div",Sa,[a(X,{modelValue:e.horario.tipo,"onUpdate:modelValue":o[1]||(o[1]=l=>e.horario.tipo=l),options:e.turnos,label:"Horario de trabajo",style:{"max-width":"240px"}},null,8,["modelValue","options"])]),s("div",Aa,[a(M,{ref:"inicio",filled:"",modelValue:e.horario.inicio,"onUpdate:modelValue":o[3]||(o[3]=l=>e.horario.inicio=l),mask:"time",rules:["time"],label:"Hora inicio",class:"q-ml-sm",style:{"max-width":"180px"}},{append:t(()=>[a(re,{name:"access_time",class:"cursor-pointer"},{default:t(()=>[a(ke,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(Le,{modelValue:e.horario.inicio,"onUpdate:modelValue":o[2]||(o[2]=l=>e.horario.inicio=l)},{default:t(()=>[s("div",Ua,[ge(a($,{label:"Close",color:"primary",flat:""},null,512),[[_e]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Pa,[a(M,{ref:"fin",filled:"",modelValue:e.horario.final,"onUpdate:modelValue":o[5]||(o[5]=l=>e.horario.final=l),mask:"time",rules:["time"],label:"Hora final",class:"q-ml-sm",style:{"max-width":"180px"}},{append:t(()=>[a(re,{name:"access_time",class:"cursor-pointer"},{default:t(()=>[a(ke,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(Le,{modelValue:e.horario.final,"onUpdate:modelValue":o[4]||(o[4]=l=>e.horario.final=l)},{default:t(()=>[s("div",ja,[ge(a($,{label:"Close",color:"primary",flat:""},null,512),[[_e]])])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Fa,[s("div",Ma,[a($,{color:"primary",outline:"",square:"",size:"md",icon:"more_time",onClick:e.addHorario},{default:t(()=>[a(A,{anchor:"center left",self:"center left"},{default:t(()=>[P(" Guardar horario ")]),_:1})]),_:1},8,["onClick"])])])]),e.horarios.show?(y(),Y("div",Ia,[s("div",za,[Ea,e.areaData.horarios.length>0?(y(!0),Y(ie,{key:0},me(e.areaData.horarios,l=>(y(),x(aa,{modelValue:e.areaData.horario_estudio,"onUpdate:modelValue":o[6]||(o[6]=c=>e.areaData.horario_estudio=c),val:l.tipo,label:l.tipo,class:"",onDblclick:c=>e.deleteHorario(l.tipo)},{default:t(()=>[a(A,null,{default:t(()=>[P(z(`${l.inicio} - ${l.final}`),1)]),_:2},1024)]),_:2},1032,["modelValue","val","label","onDblclick"]))),256)):Z("",!0)]),s("div",Oa,[Na,a(Ae,{modelValue:e.areaData.estudio_por,"onUpdate:modelValue":o[7]||(o[7]=l=>e.areaData.estudio_por=l),options:e.estudio_por_options,color:"primary",inline:""},null,8,["modelValue","options"])])])):Z("",!0),e.areaData.estudio_por!=="puesto_trabajo"&&e.areaData.estudio_por!=""?(y(),Y("div",Ta,[a(X,{class:"d-inline q-pa-sm",filled:"",label:"Zonas",modelValue:e.areaData.zonas,"onUpdate:modelValue":o[8]||(o[8]=l=>e.areaData.zonas=l),options:e.zonas,style:{"min-width":"180px"}},null,8,["modelValue","options"]),a(M,{type:"number",class:"d-inline q-pa-sm",filled:"",label:"X",modelValue:e.areaData.x,"onUpdate:modelValue":o[9]||(o[9]=l=>e.areaData.x=l)},null,8,["modelValue"]),a(M,{type:"number",class:"d-inline q-pa-sm",filled:"",label:"Y",modelValue:e.areaData.y,"onUpdate:modelValue":o[10]||(o[10]=l=>e.areaData.y=l)},null,8,["modelValue"]),a(M,{type:"number",class:"d-inline q-pa-sm",filled:"",label:"H",modelValue:e.areaData.h,"onUpdate:modelValue":o[11]||(o[11]=l=>e.areaData.h=l)},null,8,["modelValue"]),a(M,{type:"number",class:"d-inline q-pa-sm",filled:"",label:"IC",modelValue:e.areaData.ic,"onUpdate:modelValue":o[12]||(o[12]=l=>e.areaData.ic=l)},null,8,["modelValue"]),a(M,{class:"q-ml-lg q-pa-sm",modelValue:e.areaData.recurrencia,"onUpdate:modelValue":o[13]||(o[13]=l=>e.areaData.recurrencia=l),label:"D\xEDas que se labora",style:{"min-width":"200px"}},null,8,["modelValue"])])):Z("",!0),s("div",Qa,[s("div",La,[a(Pe,{modelValue:e.areaData.question1,"onUpdate:modelValue":o[14]||(o[14]=l=>e.areaData.question1=l),color:"primary",label:"\xBFSe consider\xF3 los reportes de los trabajadores para el presente reconocimiento?"},null,8,["modelValue"])]),s("div",Ya,[a(Pe,{modelValue:e.areaData.question2,"onUpdate:modelValue":o[15]||(o[15]=l=>e.areaData.question2=l),color:"primary",label:"\xBFInfluye luz natural?"},null,8,["modelValue"])])])]),_:1}),a(K,null,{default:t(()=>[Ra,a(ya),s("div",Ba,[s("div",Ga,[a(M,{type:"number",min:"0",label:"Total luminarias",modelValue:e.areaData.total_luminarias,"onUpdate:modelValue":o[16]||(o[16]=l=>e.areaData.total_luminarias=l)},null,8,["modelValue"])]),s("div",Ha,[a(Pe,{modelValue:e.areaData.question3,"onUpdate:modelValue":o[17]||(o[17]=l=>e.areaData.question3=l),class:"q-ml-lg",color:"primary",label:"\xBFLas luminarias son nuevas?"},null,8,["modelValue"])]),s("div",Ja,[a(X,{modelValue:e.luminaria_select.tipo,"onUpdate:modelValue":o[18]||(o[18]=l=>e.luminaria_select.tipo=l),options:e.luminarias_tipo,label:"Tipo luminaria",style:{"max-width":"200px"}},null,8,["modelValue","options"])]),e.luminaria_select.tipo==="Otro"?(y(),Y("div",Xa,[a(M,{label:"Tipo luminaria",modelValue:e.luminaria_select.tipo_otro,"onUpdate:modelValue":o[19]||(o[19]=l=>e.luminaria_select.tipo_otro=l)},null,8,["modelValue"])])):Z("",!0)]),s("div",Ka,[s("div",Wa,[a(M,{type:"number",min:"0",label:"Cantidad",class:"q-pa-sm",modelValue:e.luminaria_select.cantidad,"onUpdate:modelValue":o[20]||(o[20]=l=>e.luminaria_select.cantidad=l)},null,8,["modelValue"])]),s("div",Za,[a(M,{type:"number",min:"0",label:"L\xE1mparas",class:"q-pa-sm",modelValue:e.luminaria_select.lamparas,"onUpdate:modelValue":o[21]||(o[21]=l=>e.luminaria_select.lamparas=l)},null,8,["modelValue"])]),s("div",xa,[a(M,{type:"number",min:"0",label:"Potencia",class:"q-pa-sm",modelValue:e.luminaria_select.potencia,"onUpdate:modelValue":o[22]||(o[22]=l=>e.luminaria_select.potencia=l)},null,8,["modelValue"])]),s("div",el,[a($,{icon:"lightbulb",color:"primary",outline:"",onClick:e.addLuminaria},{default:t(()=>[a(A,null,{default:t(()=>[P(" Guardar luminaria ")]),_:1})]),_:1},8,["onClick"])])]),s("div",al,[(y(!0),Y(ie,null,me(e.areaData.luminarias,(l,c)=>(y(),x(oe,{outline:"",color:"orange",key:c},{default:t(()=>[s("span",{onDblclick:n=>e.deleteLuminaria(c),class:"text-body2"}," Tipo: "+z(l.tipo)+" Cantidad: "+z(l.cantidad)+" L\xE1mparas: "+z(l.lamparas)+" Potencia: "+z(l.potencia),41,ll)]),_:2},1024))),128))])]),_:1}),a(K,{class:"q-mb-lg"},{default:t(()=>[ol,s("div",sl,[s("div",tl,[a(M,{modelValue:e.areaIluminada.puesto_trabajo,"onUpdate:modelValue":o[23]||(o[23]=l=>e.areaIluminada.puesto_trabajo=l),label:"Puesto de trabajo",style:{"max-width":"200px"}},null,8,["modelValue"])]),s("div",il,[rl,a(Ae,{modelValue:e.areaIluminada.colorMaterial,"onUpdate:modelValue":o[24]||(o[24]=l=>e.areaIluminada.colorMaterial=l),options:e.options_color_material,label:"textos",color:"primary",inline:""},null,8,["modelValue","options"])]),s("div",nl,[a(X,{modelValue:e.color,"onUpdate:modelValue":o[25]||(o[25]=l=>e.color=l),options:e.colores,label:"Color",style:{"max-width":"250px"}},null,8,["modelValue","options"]),e.color.valor==17?(y(),x(M,{key:0,label:"Color",modelValue:e.color.otro_valor,"onUpdate:modelValue":o[26]||(o[26]=l=>e.color.otro_valor=l),class:"q-mt-sm q-ml-sm",style:{"max-width":"250px"}},null,8,["modelValue"])):Z("",!0)]),s("div",dl,[a(X,{modelValue:e.material,"onUpdate:modelValue":o[27]||(o[27]=l=>e.material=l),options:e.materiales,label:"Material",style:{"max-width":"250px"}},null,8,["modelValue","options"]),e.material.valor==="P"?(y(),x(M,{key:0,label:"Material",modelValue:e.material.otro_valor,"onUpdate:modelValue":o[28]||(o[28]=l=>e.material.otro_valor=l),class:"q-mt-sm",style:{"max-width":"250px"}},null,8,["modelValue"])):Z("",!0)]),s("div",ul,[a($,{icon:"tune",color:"primary",class:"q-mt-md",outline:"",onClick:o[29]||(o[29]=l=>e.addOptions("color-material"))},{default:t(()=>[a(A,null,{default:t(()=>[P(" Agregar color-material ")]),_:1})]),_:1})])]),s("div",cl,[(y(!0),Y(ie,null,me(e.areaIluminada.color_material,(l,c)=>(y(),x(oe,{color:"orange",key:c},{default:t(()=>[s("span",{onDblclick:n=>e.deleteColorMaterial(c,"plano"),class:"text-body2"}," Tipo: "+z(l.tipo)+" "+z(l.label),41,ml)]),_:2},1024))),128))]),s("div",vl,[s("div",pl,[fl,a(Ae,{modelValue:e.areaIluminada.superficie_plano,"onUpdate:modelValue":o[30]||(o[30]=l=>e.areaIluminada.superficie_plano=l),options:e.superficies,color:"primary",inline:"",onDblclick:o[31]||(o[31]=l=>e.areaIluminada.superficie_plano="")},null,8,["modelValue","options"])]),s("div",gl,[_l,a(Ae,{modelValue:e.areaIluminada.superficie_pared,"onUpdate:modelValue":o[32]||(o[32]=l=>e.areaIluminada.superficie_pared=l),options:e.superficies,color:"primary",inline:"",onDblclick:o[33]||(o[33]=l=>e.areaIluminada.superficie_pared="")},null,8,["modelValue","options"])]),s("div",bl,[a($,{label:"guardar",class:"q-mt-md",color:"primary",outline:"",onClick:o[34]||(o[34]=l=>e.addOptions("guardar"))},{default:t(()=>[a(A,null,{default:t(()=>[P(" Guardar puesto de trabajo ")]),_:1})]),_:1})])])]),_:1}),a(K,null,{default:t(()=>[hl,(y(!0),Y(ie,null,me(e.areaData.areas_iluminadas,(l,c)=>(y(),Y("div",{key:c},[s("div",yl,[s("div",Vl,[s("div",ql,[s("div",wl,[a(oe,{outline:"",color:"grey-9",id:`label_${c}`,onClick:n=>e.editNamePosition(c,"editar"),class:"capitalize q-mr-md",label:l.puesto_trabajo},{default:t(()=>[a(A,null,{default:t(()=>[P("Click para editar nombre")]),_:1})]),_:2},1032,["id","onClick","label"]),a($,{class:"q-mr-md",icon:"delete",color:"red-4",onClick:n=>e.deleteAreaIluminada(c)},{default:t(()=>[a(A,null,{default:t(()=>[P("Eliminar puesto de trabajo")]),_:1})]),_:2},1032,["onClick"]),a($,{class:"btn-icon ml-1",icon:"visibility",color:"orange-4",onClick:n=>e.showColors(l)},{default:t(()=>[a(A,null,{default:t(()=>[P("Mostrar descripci\xF3n color-material")]),_:1})]),_:2},1032,["onClick"])])])]),s("div",$l,[s("div",kl,[(y(),x(X,{label:"Tarea visual",modelValue:l.tarea_visual,"onUpdate:modelValue":n=>l.tarea_visual=n,options:e.tableA1,"option-label":"fo_aml_01_3",key:e.tableA1.id,class:"q-pa-sm"},null,8,["modelValue","onUpdate:modelValue","options"]))]),s("div",Cl,[a(X,{modelValue:l.condicion,"onUpdate:modelValue":n=>l.condicion=n,options:e.condiciones,class:"q-pa-sm"},{prepend:t(()=>[a(re,{name:"help",color:"orange"},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle",offset:[20,10]},{default:t(()=>[P(" Percepci\xF3n de las condiciones de iluminaci\xF3n por parte del trabajador al patr\xF3n ")]),_:1})]),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","options"])]),s("div",Dl,[a(X,{label:"Descripci\xF3n puesto de trabajo",modelValue:l.descripcion,"onUpdate:modelValue":n=>l.descripcion=n,options:e.descripciones,class:"q-pa-sm"},null,8,["modelValue","onUpdate:modelValue","options"])])]),s("div",Sl,[s("div",Al,[a(M,{type:"number",label:"No. Trabajadores",modelValue:l.trabajadores,"onUpdate:modelValue":n=>l.trabajadores=n,min:"0",class:"q-pa-sm"},null,8,["modelValue","onUpdate:modelValue"])]),s("div",Ul,[a(M,{type:"number",label:"Total tareas visuales",modelValue:l.tareas,"onUpdate:modelValue":n=>l.tareas=n,disabled:e.areaData.estudio_por=="area",min:"0",class:"q-pa-sm"},null,8,["modelValue","onUpdate:modelValue","disabled"])])])])]))),128))]),_:1}),a(K,{class:"q-mt-md"},{default:t(()=>[Pl,s("div",jl,[s("div",Fl,[a(M,{class:"",label:"Observaciones",modelValue:e.areaData.observaciones,"onUpdate:modelValue":o[35]||(o[35]=l=>e.areaData.observaciones=l),style:{"max-width":"250px"}},null,8,["modelValue"])]),s("div",Ml,[a(X,{class:"",modelValue:e.areaData.elabora,"onUpdate:modelValue":o[36]||(o[36]=l=>e.areaData.elabora=l),options:e.responsables_list,label:"Elabor\xF3",style:{"max-width":"250px"}},null,8,["modelValue","options"])]),s("div",Il,[a(X,{class:"",modelValue:e.areaData.revisa,"onUpdate:modelValue":o[37]||(o[37]=l=>e.areaData.revisa=l),options:e.responsables_list,label:"Revis\xF3",style:{"max-width":"250px"}},null,8,["modelValue","options"])])])]),_:1}),a(K,null,{default:t(()=>[s("div",zl,[a($,{label:"cancelar",color:"dark",onClick:e.resetModal,class:"q-mr-md"},null,8,["onClick"]),a($,{label:"guardar",color:"primary",onClick:e.saveArea},null,8,["onClick"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(je,{modelValue:e.mostrarColores,"onUpdate:modelValue":o[39]||(o[39]=l=>e.mostrarColores=l)},{default:t(()=>[a(de,{style:{width:"350px"}},{default:t(()=>[s("div",El,[s("div",Ol,[a(K,null,{default:t(()=>[(y(!0),Y(ie,null,me(e.puesto_mostrar.color_material,l=>(y(),Y("p",null,[(l.color_otro=="undefined"||l.color_otro==null)&&(l.material_otro=="undefined"||l.material_otro==null)?(y(),Y("span",Nl,z(l.tipo)+" | "+z(l.label),1)):(y(),Y("span",Tl,z(l.tipo)+" | "+z(l.color_otro)+", "+z(l.material_otro),1))]))),256))]),_:1})])])]),_:1})]),_:1},8,["modelValue"])],64)}var Ll=ye($a,[["render",Ql],["__scopeId","data-v-3fe95c89"]]);const Yl=be({name:"AsignarPuntos",props:["show","area_id","service_id"],emits:["closeModal","submit"],setup(e,o){const b=Ve();qe();const C=we(),{staff:f,sin_asignar:q,asignados:l,dispositivos:c,usuariosDevice:n,managePoints:E,getDepartments:N}=C,I=Re(e,"show"),O=d(I==!0),g=d(""),T=d(null),i=d([]),Q=d([]),h=d(""),r=d(""),U=d(!1),w=d([]),V=(m,k)=>{b.notify({position:"top",type:k,message:m})};W(I,async m=>{m&&(await E({area_id:e.area_id,action:"get"}),w.value=l.value.filter(k=>k.area_id==e.area_id)),O.value=m},{deep:!0}),W(O,m=>{m||(T.value=null,o.emit("closeModal",!1))}),W(T,m=>{r.value="",U.value=!1,g.value="";let k=[];T.value!=null&&(n.value.map(B=>{k.push(B.device.value),B.usuario.value==m.value&&B.device!=null&&(U.value=!0,r.value=B.device)}),c.value.map((B,ae)=>{k.indexOf(B.value)>-1&&c.value.splice(ae,1)}))});const u=async(m,k)=>{Q.value.push(m.value),(await E({area_id:e.area_id,action:"set",usuario_id:m.user_id,sin_asignar:Q.value,servicio_id:e.service_id})).status==200?(await E({area_id:e.area_id,action:"get"}),await N({servicio_id:e.service_id}),w.value=l.value.filter(ae=>ae.area_id==e.area_id),V("Se quit\xF3 el punto de medici\xF3n","positive")):V("Por favor contacta al administrador","negative")},_=async()=>{if(T.value==null)return V("Para continuar selecciona un usuario","negative"),!1;if(i.value.length==0)return V("No hay puntos para asignar","negative"),!1;b.dialog({title:"\xBFDeseas continuar?",message:"Se asignar\xE1n los puntos de medici\xF3n",ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async m=>{(await E({area_id:e.area_id,action:"set",usuario_id:T.value.value,para_asignar:i.value,sin_asignar:Q.value,device_id:r.value.value,signatario_id:g.value.value,servicio_id:e.service_id})).status==200?(await E({area_id:e.area_id,action:"get"}),await N({servicio_id:e.service_id}),w.value=l.value.filter(B=>B.area_id==e.area_id),V("Se asignaron los puntos de medici\xF3n","positive")):V("Por favor contacta al administrador","negative")})},D=()=>{if(h.value=="")return V("Por favor indica un nombre o ubicaci\xF3n","negative"),!1;b.dialog({title:"\xBFDeseas continuar?",message:"Se crear\xE1 un punto de medici\xF3n",ok:{push:!0,label:"Continuar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async m=>{(await E({area_id:e.area_id,action:"add",punto:h.value})).status==200?(await E({area_id:e.area_id,action:"get"}),await N({servicio_id:e.service_id}),V("Se cre\xF3 un punto de medici\xF3n","positive"),h.value=""):V("Por favor contacta al administrador","negative")})};return he(async()=>{O.value=I.value==!0,o.emit("closeModal",!1)}),{ver:O,staff:f,sin_asignar:q,asignados:l,usuarioAsignar:T,puntosSeleccion:i,nuevoPunto:h,dispositivos:c,dispositivo:r,deviceAssigned:U,signatario:g,asignadosArea:w,asignarStaff:_,quitarPunto:u,crearPunto:D}}}),Rl={class:"q-ma-md q-mb-lg"},Bl={class:"row justify-between"},Gl=s("div",null,[s("span",{class:"text-h6"},"Asignar Staff")],-1),Hl=s("div",{class:"row q-pa-sm"},null,-1),Jl={class:"row q-pa-sm"},Xl={class:"col-xs-12 col-md-4"},Kl={class:"col-xs-12 col-md-4"},Wl={class:"col-xs-12 col-md-4"},Zl={class:"row q-pa-sm"},xl={class:"col-md-3"},eo={class:"row q-pa-sm"},ao={class:"col-xs-12 col-md-3"},lo={class:"col-xs-4"},oo={class:"row q-pa-sm q-mt-md"},so={class:"q-gutter-sm"},to=s("p",{class:"text-subtitle"},"Puntos de medici\xF3n de \xE1rea",-1),io={class:"row q-mt-md scroll bg-grey-4",style:{height:"350px"}},ro={class:"text-subtitle1 block"},no=["src"],uo={class:"text-subtitle2 q-mt-sm"};function co(e,o,b,C,f,q){return y(),Y("div",Rl,[a(je,{modelValue:e.ver,"onUpdate:modelValue":o[6]||(o[6]=l=>e.ver=l),persistent:""},{default:t(()=>[a(de,{style:{"min-width":"950px"}},{default:t(()=>[a(K,null,{default:t(()=>[s("div",Bl,[Gl,s("div",null,[a(re,{name:"close",size:"md",class:"cursor-pointer",onClick:o[0]||(o[0]=l=>e.ver=!e.ver)})])]),Hl,s("div",Jl,[s("div",Xl,[a(X,{options:e.staff,modelValue:e.usuarioAsignar,"onUpdate:modelValue":o[1]||(o[1]=l=>e.usuarioAsignar=l),label:"Usuario captura",style:{width:"95%"}},null,8,["options","modelValue"])]),s("div",Kl,[a(X,{options:e.staff,modelValue:e.signatario,"onUpdate:modelValue":o[2]||(o[2]=l=>e.signatario=l),label:"Usuario signatario",style:{width:"95%"}},null,8,["options","modelValue"])]),s("div",Wl,[a(X,{options:e.dispositivos,readonly:e.deviceAssigned,modelValue:e.dispositivo,"onUpdate:modelValue":o[3]||(o[3]=l=>e.dispositivo=l),label:"Equipo",style:{width:"95%"}},null,8,["options","readonly","modelValue"])])]),s("div",Zl,[s("div",xl,[a($,{label:"Asignar",color:"primary",onClick:e.asignarStaff},null,8,["onClick"])])]),s("div",eo,[s("div",ao,[a(M,{label:"Nombre/ubicaci\xF3n punto",modelValue:e.nuevoPunto,"onUpdate:modelValue":o[4]||(o[4]=l=>e.nuevoPunto=l),style:{width:"95%"}},null,8,["modelValue"])]),s("div",lo,[a($,{class:"q-mt-md q-ml-sm",label:"Crear punto",color:"primary",onClick:e.crearPunto},null,8,["onClick"])])]),s("div",oo,[s("div",so,[to,(y(!0),Y(ie,null,me(e.sin_asignar,(l,c)=>(y(),x(Pe,{key:c,color:"primary",label:`${c+1}-${l.text}`,modelValue:e.puntosSeleccion,"onUpdate:modelValue":o[5]||(o[5]=n=>e.puntosSeleccion=n),val:l.value},null,8,["label","modelValue","val"]))),128))])]),s("div",io,[(y(!0),Y(ie,null,me(e.asignadosArea,(l,c)=>(y(),x(de,{class:"q-ma-sm",style:{"min-width":"190px"}},{default:t(()=>[a(K,{class:"row justify-between"},{default:t(()=>[a($,{icon:"delete",size:"xs",color:"red-4",onClick:n=>e.quitarPunto(l,c)},null,8,["onClick"]),l.signatario!=null?(y(),x(oe,{key:0,label:"Signatario",color:"green",class:"cursor-pointer",outline:""},{default:t(()=>[a(A,null,{default:t(()=>[P(z(l.signatario),1)]),_:2},1024)]),_:2},1024)):Z("",!0)]),_:2},1024),a(K,{class:"text-center"},{default:t(()=>[s("p",ro,z(`${c+1}-${l.text}`),1),a(Ce,{class:"text-center",size:"sm"},{default:t(()=>[s("img",{src:l.avatar},null,8,no)]),_:2},1024),s("p",uo,z(l.nombre),1),a(oe,{label:"Equipo",color:"green",class:"cursor-pointer",outline:""},{default:t(()=>[a(A,null,{default:t(()=>[P(z(l.dispositivo.identificador),1)]),_:2},1024)]),_:2},1024),l.dispositivo.expira<=1?(y(),x(oe,{key:0,label:"Certificado",color:"red",class:"q-ml-md cursor-pointer",outline:""},{default:t(()=>[a(A,null,{default:t(()=>[s("p",null,"Emisi\xF3n:"+z(l.dispositivo.fecha_emision),1),s("p",null,"Expira:"+z(l.dispositivo.aniv),1)]),_:2},1024)]),_:2},1024)):Z("",!0)]),_:2},1024)]),_:2},1024))),256))])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}var mo=ye(Yl,[["render",co]]);const vo=be({name:"Log\xEDstica",components:{areas:Ll,asignar:mo},props:["servicio","id"],setup(e){const o=Ve(),b=d({id:0,department:""}),C=d(!1),f=qe(),q=we(),{AppActiveUser:l}=f,{departmentsList:c,areas:n,saveDptoDB:E,getDepartments:N,serviceItem:I,getService:O,getTableA1:g,getSignatoryList:T,saveAreaPayload:i,getDevices:Q}=q,h=d([]),r=d([]),U=R(()=>e.servicio),w=d(null),V=d({dpto:"",servicio_id:e.id}),u=d(!1),_=d(!1),D=(S,ee)=>{o.notify({position:"top",type:ee,message:S})},m=d([{label:"Id",field:"id",sortable:!1,align:"center"},{label:"\xC1rea",field:"area",sortable:!1,align:"center"},{label:"Departamento",field:"department",sortable:!0,align:"center"},{label:"Usuario",field:"usuario",name:"usuario",sortable:!1,align:"center"},{label:"Fecha",name:"fecha",field:"fecha",sortable:!0,align:"center"},{label:"Acciones",sortable:!1,align:"center",name:"acciones"}]),k=async()=>{V.value.dpto!==""&&((await E(V.value)).status===200?(D("Se agreg\xF3 un nuevo departamento","positive"),await O(e.id),await N({servicio_id:e.id}),V.value={dpto:"",servicio_id:e.id}):D("Error al agregar departamento","negative"))},B=R(()=>c.value);W(c,S=>{S!=null&&(r.value=S)}),W(n,S=>{S!=null&&(n.value=S)});const ae=()=>{if(console.log("entra?"),b.value.department==="")return D("Para continuar selecciona un departamento","negative"),!1;U.value.recognition?(console.log("abre modal completa"),C.value=!0):(console.log("sin reconocimiento"),J("crear"))},H=d([]),G=S=>{w.value=S.id,H.value=S.puntos,_.value=!0},J=(S,ee)=>{const ve=d(""),$e=d("");ee!=null?(ve.value=ee.area,$e.value=ee.department_id):$e.value=b.value.id,o.dialog({title:S=="crear"?"Agregar \xE1rea":"Editar \xE1rea",message:"Nombre de \xE1rea",prompt:{model:ve,type:"text"},ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async Ee=>{const Se={area:ve.value,service_id:e.id,department_id:$e.value};console.log(Se,ee),(await i({data:Se,area_id:ee!=null?ee.id:null,editName:!0})).status==200?(D("Se guard\xF3 el \xE1rea de forma correcta","positive"),await N({servicio_id:e.id})):D("Por favor contacta con el administrador","negative")})},ue=d(null),p=S=>{C.value=S,ue.value=null},j=S=>{_.value=S},L=S=>{w.value=S.id,S.payload!=null?(ue.value=S.payload,C.value=!0):J("editar",S)},te=S=>{o.dialog({title:"\xBFSeguro que quieres eliminar esta \xE1rea?",message:"No podr\xE1 recuperarse",html:!0,ok:{push:!0,label:"Si, eliminar",color:"red-4"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async ee=>{(await i({area_id:S.id,delete:!0})).status===200?(D("Se borr\xF3 el \xE1rea con \xE9xito","positive"),await N({servicio_id:e.id})):D("No se pudo borrar el \xE1rea","negative")})};return he(async()=>{h.value=l.value.permissions,await Q(),await N({servicio_id:e.id}),await T(),await g()}),{departamentos:r,departmentSelected:b,columns:m,areas:n,departamentosList:B,showModalDpto:u,newDpto:V,addArea:C,props:e,idArea:w,editAreaData:ue,asignarStaff:_,puntosArea:H,saveDpto:k,openModalArea:ae,openAsignar:G,closeModalEditArea:p,deleteArea:te,editArea:L,closeModalAsignar:j}}}),po={class:"q-ma-md q-mb-lg"},fo=s("div",{class:"text-h6 text-grey-8"}," Log\xEDstica ",-1),go={class:"row items-center"},_o={class:"col-md-3 col-xs-12 q-pa-sm"},bo={class:"col-md-6"},ho={class:"row q-mt-lg"},yo={class:"col-xs-12"},Vo=["src"];function qo(e,o,b,C,f,q){const l=De("areas"),c=De("asignar");return y(),Y(ie,null,[s("div",po,[a(de,null,{default:t(()=>[a(K,null,{default:t(()=>[fo]),_:1}),a(K,null,{default:t(()=>[s("div",go,[s("div",_o,[a(X,{modelValue:e.departmentSelected,"onUpdate:modelValue":o[0]||(o[0]=n=>e.departmentSelected=n),options:e.departamentosList,"option-label":"department",label:"Departamentos"},null,8,["modelValue","options"])]),s("div",bo,[a($,{class:"q-mt-md q-ml-sm",label:"Departamento",color:"primary",outline:"",onClick:o[1]||(o[1]=n=>e.showModalDpto=!e.showModalDpto)},{default:t(()=>[a(A,{anchor:"center left",self:"center left",offset:[10,10]},{default:t(()=>[P(" Agregar departamento ")]),_:1})]),_:1}),a($,{class:"q-mt-md q-ml-sm",label:"\xC1reas",color:"primary",outline:"",onClick:e.openModalArea},{default:t(()=>[a(A,{anchor:"center left",self:"center left",offset:[10,10]},{default:t(()=>[P(" Agregar \xE1reas ")]),_:1})]),_:1},8,["onClick"])])]),s("div",ho,[s("div",yo,[a(He,{style:{height:"300px"},"virtual-scroll":"",title:"\xC1reas",rows:e.areas,columns:e.columns,"row-key":"id"},{"body-cell-usuario":t(n=>[a(Fe,{key:"usuario",props:n},{default:t(()=>[a(Ce,null,{default:t(()=>[s("img",{src:n.row.avatar},null,8,Vo),a(A,null,{default:t(()=>[P(z(n.row.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-acciones":t(n=>[a(Fe,{key:"acciones",props:n},{default:t(()=>[a($,{icon:"edit",color:"green-3",class:"q-mr-sm",onClick:E=>e.editArea(n.row)},{default:t(()=>[a(A,null,{default:t(()=>[P("Editar \xE1rea")]),_:1})]),_:2},1032,["onClick"]),a($,{icon:"delete",color:"red-3",class:"q-mr-sm",onClick:E=>e.deleteArea(n.row)},{default:t(()=>[a(A,null,{default:t(()=>[P("Eliminar \xE1rea")]),_:1})]),_:2},1032,["onClick"]),a($,{icon:"group",color:"blue-3",onClick:E=>e.openAsignar(n.row)},{default:t(()=>[a(A,null,{default:t(()=>[P("Asignar staff")]),_:1})]),_:2},1032,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])])])]),_:1})]),_:1})]),a(je,{modelValue:e.showModalDpto,"onUpdate:modelValue":o[3]||(o[3]=n=>e.showModalDpto=n),"transition-show":"flip-down","transition-hide":"flip-up",persistent:""},{default:t(()=>[a(de,{class:"q-dialog-plugin"},{default:t(()=>[a(K,null,{default:t(()=>[a(M,{modelValue:e.newDpto.dpto,"onUpdate:modelValue":o[2]||(o[2]=n=>e.newDpto.dpto=n),label:"Departamento"},null,8,["modelValue"])]),_:1}),a(sa,{align:"right"},{default:t(()=>[ge(a($,{color:"dark",label:"Cancelar"},null,512),[[_e]]),a($,{color:"primary",label:"Guardar",onClick:e.saveDpto},null,8,["onClick"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(l,{show:e.addArea,servicio_id:e.props.id,departamento_id:e.departmentSelected.id,idArea:e.idArea,infoEdit:e.editAreaData,onCloseModal:e.closeModalEditArea},null,8,["show","servicio_id","departamento_id","idArea","infoEdit","onCloseModal"]),a(c,{show:e.asignarStaff,area_id:e.idArea,service_id:e.props.id,onCloseModal:e.closeModalAsignar},null,8,["show","area_id","service_id","onCloseModal"])],64)}var wo=ye(vo,[["render",qo]]);function fe(e,o,b,C){const f=[];return e.forEach(q=>{C(q)===!0?f.push(q):o.push({failedPropValidation:b,file:q})}),f}function Ue(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),Ge(e)}const $o={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},ko=["rejected"];function Co({editable:e,dnd:o,getFileInput:b,addFilesToQueue:C}){const{props:f,emit:q,proxy:l}=Be(),c=d(null),n=R(()=>f.accept!==void 0?f.accept.split(",").map(r=>(r=r.trim(),r==="*"?"*/":(r.endsWith("/*")&&(r=r.slice(0,r.length-1)),r.toUpperCase()))):null),E=R(()=>parseInt(f.maxFiles,10)),N=R(()=>parseInt(f.maxTotalSize,10));function I(r){if(e.value)if(r!==Object(r)&&(r={target:null}),r.target!==null&&r.target.matches('input[type="file"]')===!0)r.clientX===0&&r.clientY===0&&ta(r);else{const U=b();U&&U!==r.target&&U.click(r)}}function O(r){e.value&&r&&C(null,r)}function g(r,U,w,V){let u=Array.from(U||r.target.files);const _=[],D=()=>{_.length>0&&q("rejected",_)};if(f.accept!==void 0&&n.value.indexOf("*/")===-1&&(u=fe(u,_,"accept",m=>n.value.some(k=>m.type.toUpperCase().startsWith(k)||m.name.toUpperCase().endsWith(k))),u.length===0))return D();if(f.maxFileSize!==void 0){const m=parseInt(f.maxFileSize,10);if(u=fe(u,_,"max-file-size",k=>k.size<=m),u.length===0)return D()}if(f.multiple!==!0&&u.length>0&&(u=[u[0]]),u.forEach(m=>{m.__key=m.webkitRelativePath+m.lastModified+m.name+m.size}),V===!0){const m=w.map(k=>k.__key);u=fe(u,_,"duplicate",k=>m.includes(k.__key)===!1)}if(u.length===0)return D();if(f.maxTotalSize!==void 0){let m=V===!0?w.reduce((k,B)=>k+B.size,0):0;if(u=fe(u,_,"max-total-size",k=>(m+=k.size,m<=N.value)),u.length===0)return D()}if(typeof f.filter=="function"){const m=f.filter(u);u=fe(u,_,"filter",k=>m.includes(k))}if(f.maxFiles!==void 0){let m=V===!0?w.length:0;if(u=fe(u,_,"max-files",()=>(m++,m<=E.value)),u.length===0)return D()}if(D(),u.length>0)return u}function T(r){Ue(r),o.value!==!0&&(o.value=!0)}function i(r){Ge(r),(r.relatedTarget!==null||ia.is.safari!==!0?r.relatedTarget!==c.value:document.elementsFromPoint(r.clientX,r.clientY).includes(c.value)===!1)===!0&&(o.value=!1)}function Q(r){Ue(r);const U=r.dataTransfer.files;U.length>0&&C(null,U),o.value=!1}function h(r){if(o.value===!0)return ne("div",{ref:c,class:`q-${r}__dnd absolute-full`,onDragenter:Ue,onDragover:Ue,onDragleave:i,onDrop:Q})}return Object.assign(l,{pickFiles:I,addFiles:O}),{pickFiles:I,addFiles:O,onDragover:T,onDragleave:i,processFiles:g,getDndNode:h,maxFilesNumber:E,maxTotalSizeNumber:N}}var Do=Ye({name:"QFile",inheritAttrs:!1,props:{...ra,...na,...$o,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...da,...ko],setup(e,{slots:o,emit:b,attrs:C}){const{proxy:f}=Be(),q=ua(),l=d(null),c=d(!1),n=ca(e),{pickFiles:E,onDragover:N,onDragleave:I,processFiles:O,getDndNode:g}=Co({editable:q.editable,dnd:c,getFileInput:ae,addFilesToQueue:H}),T=ma(e),i=R(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),Q=R(()=>Qe(i.value)),h=R(()=>i.value.map(p=>p.name).join(", ")),r=R(()=>Va(i.value.reduce((p,j)=>p+j.size,0))),U=R(()=>({totalSize:r.value,filesNumber:i.value.length,maxFiles:e.maxFiles})),w=R(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:n.value,...C,id:q.targetUid.value,disabled:q.editable.value!==!0})),V=R(()=>"q-file q-field--auto-height"+(c.value===!0?" q-file--dnd":"")),u=R(()=>e.multiple===!0&&e.append===!0);function _(p){const j=i.value.slice();j.splice(p,1),m(j)}function D(p){const j=i.value.findIndex(p);j>-1&&_(j)}function m(p){b("update:modelValue",e.multiple===!0?p:p[0])}function k(p){p.keyCode===13&&fa(p)}function B(p){(p.keyCode===13||p.keyCode===32)&&E(p)}function ae(){return l.value}function H(p,j){const L=O(p,j,i.value,u.value),te=ae();te!=null&&(te.value=""),L!==void 0&&((e.multiple===!0?e.modelValue&&L.every(S=>i.value.includes(S)):e.modelValue===L[0])||m(u.value===!0?i.value.concat(L):L))}function G(){return[ne("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function J(){if(o.file!==void 0)return i.value.length===0?G():i.value.map((j,L)=>o.file({index:L,file:j,ref:this}));if(o.selected!==void 0)return i.value.length===0?G():o.selected({files:i.value,ref:this});if(e.useChips===!0)return i.value.length===0?G():i.value.map((j,L)=>ne(ba,{key:"file-"+L,removable:q.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{_(L)}},()=>ne("span",{class:"ellipsis",textContent:j.name})));const p=e.displayValue!==void 0?e.displayValue:h.value;return p.length>0?[ne("div",{class:e.inputClass,style:e.inputStyle,textContent:p})]:G()}function ue(){const p={ref:l,...w.value,...T.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:H};return e.multiple===!0&&(p.multiple=!0),ne("input",p)}return Object.assign(q,{fieldClass:V,emitValue:m,hasValue:Q,inputRef:l,innerValue:i,floatingLabel:R(()=>Q.value===!0||Qe(e.displayValue)),computedCounter:R(()=>{if(e.counterLabel!==void 0)return e.counterLabel(U.value);const p=e.maxFiles;return`${i.value.length}${p!==void 0?" / "+p:""} (${r.value})`}),getControlChild:()=>g("file"),getControl:()=>{const p={ref:q.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return q.editable.value===!0&&Object.assign(p,{onDragover:N,onDragleave:I,onKeydown:k,onKeyup:B}),ne("div",p,[ue()].concat(J()))}}),Object.assign(f,{removeAtIndex:_,removeFile:D,getNativeElement:()=>l.value}),va(f,"nativeEl",()=>l.value),pa(q)}});const So=be({name:"Archivos",props:["servicio_id"],setup(e){const o=Ve(),b=qe(),C=we(),{AppActiveUser:f}=b,{getSectionFile:q,saveSectionFile:l,removeFile:c,archivos:n,secciones:E}=C,N=d(!1),I=d(!1),O=d(null),g=d(),T=d(!1),i=d(),Q=(w,V)=>{o.notify({position:"top",type:V,message:w})};W(f,w=>{h.value=w.permissions,console.log("set permisos")});const h=d([]);W(h,w=>{if(w!=null){const V=w;console.log("permisos_usuario",w),N.value=V.find(u=>u==="cargar_archivo"),I.value=V.find(u=>u==="borrar_archivo")}});const r=d([{label:"Id",field:"id",sortable:!1,align:"center"},{label:"Archivo",field:"name",sortable:!1,align:"center"},{label:"Usuario",name:"usuario",sortable:!0,align:"center"},{label:"Fecha",name:"fecha",field:"creation_date",sortable:!0,align:"center"},{label:"Acciones",sortable:!1,align:"center",name:"acciones"}]),U=async()=>{if(g.value=null,console.log(i.value),O.value==null)return Q("Para continuar selecciona una secci\xF3n","negative"),!1;const w=await l({files:g.value,service_id:e.servicio_id,seccion_id:O.value.id});i.value=d(),w.status==200?(Q("Archivo cargado con \xE9xito","positive"),g.value.value=null,i.value.value=null,T.value=!1,await q({service_id:e.servicio_id,type:"get"})):Q("Error al cargar archivo","negative")};return he(async()=>{await q({service_id:e.servicio_id,type:"get"}),(f.value!=null||f.value!=null)&&(h.value=f.value.permissions)}),{archivos:n,secciones:E,columns:r,seccion:O,uploader:g,loading:T,inputFile:i,upLoadFile:U,cargar_archivos:N,borrar_archivos:I}}}),Ao={class:"q-ma-md"},Uo={key:0,class:"row"},Po={class:"col-xs-12 col-md-4",id:"fileInput"},jo={class:"col-xs-12 col-md-3"},Fo={class:"row justify-end"},Mo={class:"row q-mt-lg"},Io={class:"col-xs-12"},zo=["src"];function Eo(e,o,b,C,f,q){return y(),Y("div",Ao,[e.cargar_archivos?(y(),Y("div",Uo,[s("div",Po,[a(Do,{for:"fileInput",class:"q-mt-sm",ref:"inputFile",modelValue:e.uploader,"onUpdate:modelValue":o[0]||(o[0]=l=>e.uploader=l),filled:"",type:"file",label:"Selecciona un archivo"},null,8,["modelValue"]),e.loading?(y(),x(qa,{key:0,class:"q-ml-lg",color:"primary",size:"lg"})):Z("",!0)]),s("div",jo,[a(X,{modelValue:e.seccion,"onUpdate:modelValue":o[1]||(o[1]=l=>e.seccion=l),options:e.secciones,label:"Secci\xF3n",class:"q-pa-sm"},null,8,["modelValue","options"]),s("div",Fo,[a($,{icon:"cloud_upload",class:"q-ml-sm q-mt-sm",color:"primary",onClick:e.upLoadFile},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle"},{default:t(()=>[P("Cargar archivo")]),_:1})]),_:1},8,["onClick"])])])])):Z("",!0),s("div",Mo,[s("div",Io,[a(He,{style:{height:"300px"},"virtual-scroll":"",title:"Archivos",rows:e.archivos,columns:e.columns,"row-key":"id"},{"body-cell-usuario":t(l=>[a(Fe,{key:"usuario",props:l},{default:t(()=>[a(Ce,null,{default:t(()=>[s("img",{src:l.row.usuario.avatar},null,8,zo),a(A,null,{default:t(()=>[P(z(l.row.usuario.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["props"])]),"body-cell-acciones":t(l=>[a(Fe,{key:"acciones",props:l},{default:t(()=>[a($,{icon:"description",color:"green-3",class:"q-mr-sm",href:l.row.url,target:"_blank"},{default:t(()=>[a(A,null,{default:t(()=>[P("Ver archivo")]),_:1})]),_:2},1032,["href"]),a($,{icon:"delete",color:"red-3",class:"q-mr-sm",onClick:c=>e.deleteArea(l.row),disabled:!e.borrar_archivos},{default:t(()=>[a(A,null,{default:t(()=>[P("Borrar archivo")]),_:1})]),_:2},1032,["onClick","disabled"])]),_:2},1032,["props"])]),_:1},8,["rows","columns"])])])])}var Oo=ye(So,[["render",Eo]]);const No=be({name:"Gestion",components:{archivos:Oo},props:["servicio_id","signatory"],setup(e,o){const b=Ve();qe();const C=we(),{staff:f,managePoints:q,sin_asignar:l,asignados:c,serviceItem:n,getSignatoryList:E,signatoryList:N,saveSignatory:I,getFieldSheets:O,getPdfFieldSheets:g,getReport:T}=C,i=(u,_)=>{b.notify({position:"top",type:_,message:u})},Q=R(()=>e.signatory),h=d({elabora:"",revisa:""});W(Q,u=>{u!=null&&(h.value=JSON.parse(u))});const r=async()=>{const u=await O(e.servicio_id);if(u.data.capturas.points.length>=1){const _=ze.json_to_sheet(u.data.capturas.points),D=ze.book_new();ze.book_append_sheet(D,_,"capturas_puntos_medicion"),ha(D,`Capturas_servicio_${e.servicio_id}.xlsx`)}else i("No hay informaci\xF3n de capturas para descargar","warning")},U=async()=>{const u=await g(e.servicio_id);if(u.data){const _=`data:application/pdf;base64,${u.data.hojas_campo}`,D=document.createElement("a"),m=`${e.servicio_id}_hojas_campo.pdf`;return D.href=_,D.download=m,D.click(),!0}i("No hay informaci\xF3n de capturas para descargar","negative")},w=async()=>{if(h.value.elabora==""||h.value.revisa=="")return i("Por favor selecciona a un responsable","negative"),!1;b.dialog({title:"\xBFDeseas continuar?",message:"",ok:{push:!0,label:"Continuar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async u=>{(await I({signatory:h.value,servicio_id:e.servicio_id})).status==200?i("Se agregaron los signatarios del proyecto","positive"):i("Por favor contacta con el administrador","negative")})},V=async()=>{if(!n.value.generar_reporte)return b.dialog({title:"No es posible generar reporte",message:`Faltan ${n.value.total_puntos-n.value.puntos_cerrados} puntos por cerrar capturas`}).onOk(()=>{}),!1;try{if(b.loading.show(),(await T(e.servicio_id)).status==200)return b.loading.hide(),b.dialog({title:"Reporte en proceso",message:"El reporte terminar\xE1 de crearse en unos minutos, por favor recarga la pantalla"}).onOk(()=>{}),n.value.status_report="en proceso",!0}catch(u){i("Hubo un error al generar el reporte","negative"),b.loading.hide(),console.log("mensaje falla",u)}};return he(()=>{}),{props:e,signatoryList:N,signatario:h,serviceItem:n,addSignatory:w,downloadFieldSheets:r,downloadPdfFieldSheets:U,generarReporte:V}}}),To={class:"q-ma-md",style:{"margin-top":"50px"}},Qo=s("div",{class:"text-h6 text-grey-8"},"Gesti\xF3n",-1),Lo=s("div",{class:"text-subtitle text-grey-8"},"Signatarios y destinatarios",-1),Yo={class:"row q-pa-sm"},Ro={class:"col-xs-12 col-md-3"},Bo={class:"col-xs-12 col-md-3"},Go={class:"col-xs-12 col-md-3"},Ho={class:"col-xs-12 col-md-3"},Jo={class:"col-xs-12 col-md-2"},Xo=s("div",{class:"text-subtitle text-grey-8"},"Archivos",-1),Ko=s("div",{class:"text-subtitle text-grey-8"},"Reporte y control",-1),Wo={key:0,class:"row q-pa-md bg-orange q-mt-md justify-center"},Zo=s("span",{class:"text-subtitle2 text-center text-white"}," El reporte a\xFAn est\xE1 en proceso, por favor recarga la pantalla en unos minutos. ",-1),xo=[Zo],es={class:"row q-pa-md"};function as(e,o,b,C,f,q){const l=De("archivos");return y(),Y("div",To,[a(de,null,{default:t(()=>[a(K,null,{default:t(()=>[Qo,a(ce,{spaced:""}),Lo,a(ce,{spaced:""}),s("div",Yo,[s("div",Ro,[a(X,{modelValue:e.signatario.elabora,"onUpdate:modelValue":o[0]||(o[0]=c=>e.signatario.elabora=c),options:e.signatoryList.signatario,label:"Elabor\xF3",class:"q-pa-sm"},{prepend:t(()=>[a(re,{name:"help",color:"orange"},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle",offset:[20,10]},{default:t(()=>[P(" Responsable que aparece en car\xE1tula ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),s("div",Bo,[a(X,{modelValue:e.signatario.revisa,"onUpdate:modelValue":o[1]||(o[1]=c=>e.signatario.revisa=c),options:e.signatoryList.aprueba,label:"Revis\xF3",class:"q-pa-sm"},{prepend:t(()=>[a(re,{name:"help",color:"orange"},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle",offset:[20,10]},{default:t(()=>[P(" Responsable que aparece en car\xE1tula ")]),_:1})]),_:1})]),_:1},8,["modelValue","options"])]),s("div",Go,[a(M,{label:"Dirigido a",modelValue:e.signatario.dirigido_a,"onUpdate:modelValue":o[2]||(o[2]=c=>e.signatario.dirigido_a=c),class:"q-pa-sm"},null,8,["modelValue"])]),s("div",Ho,[a(M,{label:"Representante legal",modelValue:e.signatario.representante,"onUpdate:modelValue":o[3]||(o[3]=c=>e.signatario.representante=c),class:"q-pa-sm"},null,8,["modelValue"])]),s("div",Jo,[a($,{label:"guardar",color:"primary",class:"q-mt-lg q-ml-md",onClick:e.addSignatory},null,8,["onClick"])])])]),_:1}),a(K,null,{default:t(()=>[a(ce,{spaced:""}),Xo,a(ce,{spaced:""}),a(l,{servicio_id:e.props.servicio_id},null,8,["servicio_id"])]),_:1}),a(K,{style:{"margin-bottom":"100px"}},{default:t(()=>[a(ce,{spaced:""}),Ko,a(ce,{spaced:""}),e.serviceItem.status_report=="en proceso"?(y(),Y("div",Wo,xo)):Z("",!0),s("div",es,[a($,{label:"Capturas",color:"green-4",class:"q-mr-md",onClick:e.downloadFieldSheets},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle",offset:[20,10]},{default:t(()=>[P(" Descarga archivo de excel con los datos que han sido capturados hasta el momento ")]),_:1})]),_:1},8,["onClick"]),a($,{label:"Hojas de campo",color:"green-4",class:"q-mr-md",onClick:e.downloadPdfFieldSheets},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle",offset:[20,10]},{default:t(()=>[P(" Descarga formato de hojas de campo con capturas ")]),_:1})]),_:1},8,["onClick"]),a($,{label:"Generar reporte",color:"green-4",class:"q-mr-md",onClick:e.generarReporte},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle",offset:[20,10]},{default:t(()=>[P(" Comienza creaci\xF3n de reporte, todos los datos deber\xE1n estar completos ")]),_:1})]),_:1},8,["onClick"]),a($,{label:"Descargar reporte",color:"green-4",class:"q-mr-md",disable:e.serviceItem.reporte_url==null,href:e.serviceItem.reporte_url,target:"_blank"},{default:t(()=>[a(A,{"max-width":"200px",self:"top middle",offset:[20,10]},{default:t(()=>[P(" Descarga reporte de informe de resultados ")]),_:1})]),_:1},8,["disable","href"])])]),_:1})]),_:1})])}var ls=ye(No,[["render",as]]);const os=be({name:"servicioPage",components:{logistica:wo,gestion:ls},setup(){const e=qe(),o=we(),b=Ve(),C=ga(),{AppActiveUser:f}=e,{getService:q,serviceItem:l,generarOT:c,getStaff:n,getTableA1:E,saveCaratulaPayload:N}=o,I=d(!1),O=d(!1),g=d(!1),T=d(!1),i=d(!1),Q=(H,G)=>{b.notify({position:"top",type:G,message:H})},h=d(null),r=d(null),U=d(null),w=d(""),V=d(""),u=d(""),_=R(()=>l.value),D=async()=>{w.value=_.value.recognition_date.split("-"),V.value=_.value.start_date.split("-"),u.value=_.value.end_date.split("-"),h.value=pe.formatDate(new Date(w.value[0],w.value[1]-1,w.value[2]),"YYYY/MM/DD"),r.value=pe.formatDate(new Date(V.value[0],V.value[1]-1,V.value[2]),"YYYY/MM/DD"),U.value=pe.formatDate(new Date(u.value[0],u.value[1]-1,u.value[2]),"YYYY/MM/DD")},m=d([]);W(f,H=>{m.value=H.permissions}),W(m,H=>{if(H!=null){const G=H;O.value=G.find(J=>J==="cambiar_fechas_servicio"),g.value=G.find(J=>J==="agregar_signatarios"),T.value=G.find(J=>J==="agregar_areas_reconocimiento"),i.value=G.find(J=>J==="datos_reconocimiento"),I.value=G.find(J=>J==="generar_ot")}});const k=async()=>{b.dialog({title:"\xBFEst\xE1s seguro?",message:"Se guardar\xE1n las fechas seleccionadas",ok:{push:!0,label:"Aceptar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async H=>{const G={recognition_date:pe.formatDate(h.value,"YYYY-MM-DD"),start_date:pe.formatDate(r.value,"YYYY-MM-DD"),end_date:pe.formatDate(U.value,"YYYY-MM-DD")};(await N({data:G,servicio_id:C.params.id,dates:!0})).status===200?Q("Se actualiz\xF3 la informaci\xF3n correctamente","positive"):Q("Hubo un problema al guardar la informaci\xF3n","negative")})},B=()=>{b.dialog({title:"\xBFEst\xE1s seguro?",message:"Se asingar\xE1 una OT al servicio",ok:{push:!0,label:"Aceptar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async H=>{ae()}).onCancel(()=>{}).onDismiss(()=>{})},ae=async()=>{if((await c({solicitud_ot:!0,servicio_id:_.value.id})).status!=200)return Q("Error al generar OT","negative"),!1;await q(C.params.id)};return he(async()=>{m.value=f.value.permissions,await n(),await q(C.params.id),await D()}),{cambiar_fechas_servicio:O,agregar_signatarios:g,generar_ot:I,logistica:T,llenar_rec:i,servicio:_,fecha1:h,fecha2:r,fecha3:U,update:k,promtOt:B}}}),ss={class:"q-pa-md q-gutter-sm"},ts={class:"q-pa-md"},is={class:"col"},rs={class:"text-h6 q-ml-sm block"},ns={class:"text-subtitle1 q-ml-sm block"},ds={class:"text-subtitle1 q-ml-sm block"},us={class:"row q-mt-md q-mb-md q-ma-sm"},cs={class:"col-md-4 col-xs-12"},ms=s("span",{class:"block label q-mb-sm"},"Orden de trabajo:",-1),vs={class:"row"},ps={key:0,class:""},fs={class:"col-lg-4 col-md-4 col-sm-12"},gs=s("span",{class:"label block q-mb-sm"},"Estatus:",-1),_s={class:"col col-lg-4 col-md-4 col-sm-12"},bs=s("span",{class:"label block q-mb-sm"},"Reconocimiento:",-1),hs={class:"row q-mt-md q-mb-lg q-ma-sm"},ys={class:"col-md-4 col-sm-12"},Vs=s("span",{class:"label"},"Solicitante",-1),qs=s("br",null,null,-1),ws=["src"],$s={class:"user-name-label"},ks={class:"col-md-4 col-sm-12"},Cs=s("span",{class:"label q-mt-sm"},"Responsable",-1),Ds=s("br",null,null,-1),Ss=["src"],As={class:"user-name-label"},Us={class:"col-md-4 col-sm-12"},Ps=s("span",{class:"label q-mt-sm"},"Fecha creaci\xF3n",-1),js=s("br",null,null,-1),Fs={class:"row q-mt-md q-mb-md"},Ms={class:"col-md-4 col-xs-12 q-mt-sm"},Is=s("span",{class:"label q-ml-sm"},"Inicio reconocimiento:",-1),zs={class:"row items-center justify-end"},Es={class:"col-md-4 col-xs-12 q-mt-sm"},Os=s("span",{class:"label q-mr-sm"},"Inicio ejecuci\xF3n:",-1),Ns={class:"row items-center justify-end"},Ts={class:"col-md-4 col-xs-12 q-mt-sm"},Qs=s("span",{class:"label q-mr-sm"},"Fin ejecuci\xF3n:",-1),Ls={class:"row items-center justify-end"},Ys={class:"row q-mr-md justify-end q-mt-sm"};function Rs(e,o,b,C,f,q){const l=De("logistica"),c=De("gestion");return y(),x(_a,{class:"q-pa-sm"},{default:t(()=>[s("div",ss,[a(xe,null,{default:t(()=>[a(Me,{icon:"home",to:{name:"index-admin"}}),a(Me,{label:"Servicios",icon:"folder",to:{name:"servicios"}}),a(Me,{label:"Servicio",icon:"file_open"})]),_:1})]),s("div",ts,[a(de,{rounded:"",class:"q-mb-md"},{default:t(()=>[a(K,null,{default:t(()=>[s("div",is,[s("span",rs," Cliente: "+z(e.servicio.cliente),1),s("span",ns," Planta: "+z(e.servicio.planta),1),s("span",ds," Producto: "+z(e.servicio.producto),1)]),s("div",us,[s("div",cs,[ms,s("div",vs,[a(oe,{transparent:"",color:e.servicio.ot==="Sin OT asignada"?"negative":"primary",outline:"",class:"uppercase",label:e.servicio.ot},null,8,["color","label"]),e.servicio.ot==="Sin OT asignada"?(y(),Y("div",ps,[e.generar_ot?(y(),x($,{key:0,flat:"",round:"",size:"sm",color:"green",class:"q-ml-sm",outline:"",icon:"check_circle",onClick:e.promtOt},{default:t(()=>[a(A,null,{default:t(()=>[P("Generar OT")]),_:1})]),_:1},8,["onClick"])):Z("",!0)])):Z("",!0)])]),s("div",fs,[gs,a(oe,{outline:"",color:e.servicio.status==="abierto"?"primary":"grey-9",class:"uppercase",label:e.servicio.status},null,8,["color","label"])]),s("div",_s,[bs,a(oe,{outline:"",label:e.servicio.recognition?"aceptado":"no aceptado",color:e.servicio.recognition?"primary":"negative",class:"uppercase"},null,8,["label","color"])])]),s("div",hs,[s("div",ys,[Vs,qs,a(Ce,{class:"q-mr-sm q-mt-sm",size:"30px"},{default:t(()=>[s("img",{src:e.servicio.requester_avatar,alt:""},null,8,ws)]),_:1}),s("span",$s,z(e.servicio.requester),1)]),s("div",ks,[Cs,Ds,a(Ce,{class:"q-mr-sm q-mt-sm",size:"30px"},{default:t(()=>[s("img",{src:e.servicio.owner_avatar,alt:""},null,8,Ss)]),_:1}),s("span",As,z(e.servicio.owner),1)]),s("div",Us,[Ps,js,a(oe,{outline:"",color:"grey-7",label:e.servicio.create_date,class:"q-mt-md"},null,8,["label"])])]),s("div",Fs,[s("div",Ms,[Is,a(M,{class:"q-mt-sm q-ml-sm",filled:"",modelValue:e.fecha1,"onUpdate:modelValue":o[1]||(o[1]=n=>e.fecha1=n),mask:"date",readonly:!e.cambiar_fechas_servicio,style:{"max-width":"180px"}},{append:t(()=>[a(re,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(ke,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(Ie,{modelValue:e.fecha1,"onUpdate:modelValue":o[0]||(o[0]=n=>e.fecha1=n),readonly:!e.cambiar_fechas_servicio},{default:t(()=>[s("div",zs,[ge(a($,{label:"Close",color:"primary",flat:""},null,512),[[_e]])])]),_:1},8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1},8,["modelValue","readonly"])]),s("div",Es,[Os,a(M,{class:"q-mt-sm",filled:"",modelValue:e.fecha2,"onUpdate:modelValue":o[3]||(o[3]=n=>e.fecha2=n),mask:"date",rules:["date"],style:{"max-width":"180px"}},{append:t(()=>[a(re,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(ke,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(Ie,{modelValue:e.fecha2,"onUpdate:modelValue":o[2]||(o[2]=n=>e.fecha2=n),readonly:!e.cambiar_fechas_servicio},{default:t(()=>[s("div",Ns,[ge(a($,{label:"Close",color:"primary",flat:""},null,512),[[_e]])])]),_:1},8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),s("div",Ts,[Qs,a(M,{class:"q-mt-sm",filled:"",modelValue:e.fecha3,"onUpdate:modelValue":o[5]||(o[5]=n=>e.fecha3=n),mask:"date",rules:["date"],style:{"max-width":"180px"}},{append:t(()=>[a(re,{name:"event",class:"cursor-pointer"},{default:t(()=>[a(ke,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:t(()=>[a(Ie,{modelValue:e.fecha3,"onUpdate:modelValue":o[4]||(o[4]=n=>e.fecha3=n),readonly:!e.cambiar_fechas_servicio},{default:t(()=>[s("div",Ls,[ge(a($,{label:"Close",color:"primary",flat:""},null,512),[[_e]])])]),_:1},8,["modelValue","readonly"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),s("div",Ys,[e.cambiar_fechas_servicio?(y(),x($,{key:0,color:"primary",onClick:e.update,label:"Guardar"},null,8,["onClick"])):Z("",!0)])]),_:1})]),_:1})]),a(l,{servicio:e.servicio,id:e.$route.params.id},null,8,["servicio","id"]),a(c,{servicio_id:e.$route.params.id,signatory:e.servicio.signatory},null,8,["servicio_id","signatory"])]),_:1})}var ct=ye(os,[["render",Rs]]);export{ct as default};
