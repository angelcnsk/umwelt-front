import{Q as S,a as $}from"./QBreadcrumbs.e2923fe3.js";import{_ as N,k as U,a as A,r as c,w as z,o as G,ak as L,n as b,A as j,q as i,u as t,j as s,K as x,al as T,z as F,L as h,D as m,Q as J,y as p,aD as O,p as P,J as H}from"./index.402e5cb0.js";import{Q as K}from"./QTooltip.df6a31f4.js";import{Q as M}from"./QPage.fbc5bef6.js";import{u as Z}from"./useUsers.3dcbe72b.js";import{S as R}from"./signature-pad.esm.b5dead29.js";import{u as W}from"./use-quasar.12cbe038.js";import"./position-engine.b4a4220a.js";const X=U({components:{SignaturePad:R},name:"EditProfile",setup(){const a=W(),{AppActiveUser:o,updateImgProfile:k,saveSignature:w,fetchUser:C}=Z(),n=A(()=>o.value),l=c(!1),e=c(""),d=c("");e.value=l.value?"visibility_off":"visibility",d.value=l.value?"text":"password";const q=()=>{l.value=!l.value,e.value=l.value?"visibility_off":"visibility",d.value=l.value?"text":"password"},D=()=>{const r=document.getElementById("input_img").files,u=new FormData;u.append("file",r[0]),k(u).status==200?a.notify({position:"top",type:"positive",message:"La foto de perfil se actualiz\xF3 con \xE9xito"}):a.notify({position:"top",type:"negative",message:"Error contacta al administrador"})},g=c(null),f=c(""),Q=()=>{a.dialog({title:"Guardar firma",message:"Se guardar\xE1 la firma y no ser\xE1 posible modificarla",ok:{push:!0,label:"Guardar"},cancel:{push:!0,color:"dark",label:"Cancelar"},persistent:!0}).onOk(async r=>{const u=B();(await w({file:JSON.stringify(u.data)})).data.msg==="success"?(await C(n.value.id),a.notify({position:"top",type:"positive",message:"La firma se guard\xF3 con \xE9xito"}),console.log(n.value,o.value)):a.notify({position:"top",type:"negative",message:"Hubo un error al guardar la firma"})}).onCancel(()=>{}).onDismiss(()=>{})},V=()=>{const{saveSignature:r}=v(),u=r();if(!u.isEmpty){var _=u.data;const y=document.createElement("a"),I="firma.png";y.href=_,y.download=I,y.click()}},v=()=>{if(!g.value)throw new Error("No signature pad ref could be found");return g.value},E=()=>{v().clearSignature()},B=()=>v().saveSignature();return z(n,r=>{console.log("SE ACTUALIZ\xD3",r),r.signature!=null&&(f.value=r.signature.split(",")[1])}),G(()=>{n.value.signature!=null&&(f.value=n.value.signature.split(",")[1])}),{userData:n,showPass:q,update_avatar:D,iconVisivility:e,typeInput:d,signaturePad:g,srcSignature:f,save:Q,savePng:V,clearSignature:E}}}),Y={class:"q-pa-md q-gutter-sm"},aa={class:"row justify-betweem"},ea={class:"bg-grey-2 square-box text-center col-xs-12 col-md-3 col-sm-4"},sa=["src"],ta={class:"text-dark q-mt-md text-weight-bold"},oa={class:"col-xs-12 col-sm-7 col-md-3 text-grey-7 ficha-datos"},ia={class:"q-mt-md"},ra={class:"q-mt-md"},la={class:"q-mt-md"},na={class:"q-mt-md"},ua=t("div",{class:"row"},[t("p",{class:"row text-h4"},"Firma ")],-1),da={key:0},ca={class:"row q-mt-md justify-center"},ma={class:"col text-center"},pa={key:1,class:"text-center"},ga=["src"];function fa(a,o,k,w,C,n){const l=L("signature-pad");return b(),j(M,{class:"q-pa-lg"},{default:i(()=>[t("div",Y,[s($,null,{default:i(()=>[s(S,{icon:"home",to:{name:"index-admin"}}),s(S,{label:"Perfil",icon:"person"})]),_:1})]),s(H,{rounded:""},{default:i(()=>[s(x,null,{default:i(()=>[t("div",aa,[t("div",ea,[s(T,{size:"120px",onClick:o[1]||(o[1]=e=>a.$refs.update_avatar_input.click())},{default:i(()=>[t("img",{src:a.userData.avatar},null,8,sa),t("input",{type:"file",id:"input_img",class:"hidden",ref:"update_avatar_input",onChange:o[0]||(o[0]=(...e)=>a.update_avatar&&a.update_avatar(...e)),accept:"image/*"},null,544)]),_:1}),t("p",ta,F(a.userData.name),1)]),t("div",oa,[t("div",ia,[s(h,{modelValue:a.userData.name,"onUpdate:modelValue":o[2]||(o[2]=e=>a.userData.name=e),label:"Nombre"},null,8,["modelValue"])]),t("div",ra,[s(h,{modelValue:a.userData.email,"onUpdate:modelValue":o[3]||(o[3]=e=>a.userData.email=e),type:"email",rules:[e=>!!e||"* Campo obligatorio",(e,d)=>d.email(e)||"Ingresa un e-mail v\xE1lido"],label:"E-mail"},null,8,["modelValue","rules"])]),t("div",la,[s(h,{"bottom-slots":"",type:a.typeInput,modelValue:a.userData.password,"onUpdate:modelValue":o[4]||(o[4]=e=>a.userData.password=e),"lazy-rules":"",label:"Password",rules:[e=>!!e||"Campo requerido"]},{append:i(()=>[s(m,{onClick:a.showPass,round:"",dense:"",flat:"",icon:a.iconVisivility},null,8,["onClick","icon"])]),prepend:i(()=>[s(J,{name:"help",class:"cursor-pointer",color:"orange"},{default:i(()=>[s(K,{class:"bg-orange"},{default:i(()=>[p("Ingresa una contrase\xF1a s\xF3lo si deseas cambiarla")]),_:1})]),_:1})]),_:1},8,["type","modelValue","rules"])])])]),t("div",na,[ua,s(O,{spaced:""}),a.userData.signature===null?(b(),P("div",da,[s(l,{width:600,height:300,customStyle:{border:"black 1px solid",display:"block",margin:"0 auto"},ref:"signaturePad",options:{onBegin:()=>{a.$refs.signaturePad.resizeCanvas()}}},null,8,["options"]),t("div",ca,[t("div",ma,[s(m,{class:"q-mr-sm",color:"primary",onClick:a.save},{default:i(()=>[p("Guardar")]),_:1},8,["onClick"]),s(m,{class:"q-mr-sm",color:"primary",onClick:a.clearSignature},{default:i(()=>[p("Deshacer")]),_:1},8,["onClick"]),s(m,{class:"q-mr-sm",color:"primary",onClick:a.savePng},{default:i(()=>[p("Guardar PNG")]),_:1},8,["onClick"])])])])):(b(),P("div",pa,[t("img",{src:`data:image/png;base64,${a.srcSignature}`,width:"600",class:"signatureSrc"},null,8,ga)]))])]),_:1})]),_:1})]),_:1})}var Sa=N(X,[["render",fa]]);export{Sa as default};
